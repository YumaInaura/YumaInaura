---
title: "#rspec ã§ allow_any_instance_of / expect_any_instance_of ãŒéæ¨å¥¨ãªç†ç”±"
emoji: "ğŸ–¥"
type: "tech"
topics: ["RSpec"]
published: true
published_at: 2020-04-24
---

# ä½•ï¼Ÿ

- ã²ã¨ã¤ã®ã‚¯ãƒ©ã‚¹ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹+ç‰¹å®šãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ expect / allow ã—ã¦ã—ã¾ã†ã®ã§ã€å˜ç´”ã«ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã§ããªã„ã§ã—ã‚‡ã† (åŒã˜ã‚¯ãƒ©ã‚¹ãŒ2å€‹ä»¥ä¸Šã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆãƒ»ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã©ã†ã™ã‚‹ã®ï¼Ÿ)
- allow_any_instance_of / expect_any_instance_of ã‚’ä½¿ã†ã¨ã„ã†ã“ã¨ã¯ãã‚‚ãã‚‚ã€ãƒ†ã‚¹ãƒˆãŒã‚„ã‚Šã™ãã‹ã€è¤‡é›‘ã§ä¹±ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯ï¼Ÿ
- rspec-mocks ã§å¤šãã®ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆãŒä¸ŠãŒã£ãŸæ­´å²ãŒã‚ã‚‹ã‚‰ã—ã„

ã¨ã„ã†ã‚ˆã†ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚‹æ°—ãŒã—ãŸã€‚

# Doc

Settings mocks or stubs on any instance of a class

rspec-mocks provides two methods, allow_any_instance_of and expect_any_instance_of, that will allow you to stub or mock any instance of a class. They are used in place of allow or expect:

```
allow_any_instance_of(Widget).to receive(:name).and_return("Wibble")
expect_any_instance_of(Widget).to receive(:name).and_return("Wobble")
```

These methods add the appropriate stub or expectation to all instances of Widget.

This feature is sometimes useful when working with legacy code, though in general we discourage its use for a number of reasons:

- The rspec-mocks API is designed for individual object instances, but this feature operates on entire classes of objects. As a result there are some semantically confusing edge cases. For - example in expect_any_instance_of(Widget).to receive(:name).twice it isn't clear whether each specific instance is expected to receive name twice, or if two receives total are expected. (It's the former.)
- Using this feature is often a design smell. It may be that your test is trying to do too much or that the object under test is too complex.
- It is the most complicated feature of rspec-mocks, and has historically received the most bug reports. (None of the core team actively use it, which doesn't help.)

[rspec/rspec-mocks: RSpec's 'test double' framework, with support for stubbing and mocking](https://github.com/rspec/rspec-mocks#settings-mocks-or-stubs-on-any-instance-of-a-class)

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/3087











<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2020-04-24
