---
title: #API ã‚’å©ãã«ã¯ #python ã¨ #shell ã¨ #jq ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã€æ¨™æº–å…¥å‡ºåŠ›ã§ãƒ‘ã‚¤ãƒ—ã™ã‚‹ã®ãŒè‰¯ã•ã’ã˜ã‚ƒãªã„ï¼Ÿ
emoji: "ğŸ–¥"
type: "idea"
topics: ["Python", "API", "shell", "jq"]
published: true
---

# Twitterã§ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¦ã€ã™ãã«ãã‚Œã‚’å‰Šé™¤ã™ã‚‹ä¾‹

- ã‚·ã‚§ãƒ«ã§ `Hello Mr.Twitter` ã‚’æ¨™æº–å‡ºåŠ›ã™ã‚‹
- python ãŒæ¨™æº–å…¥åŠ›ã‚’å—ã‘å–ã£ã¦ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¦ã€API ã‹ã‚‰å—ã‘å–ã£ãŸ json ã‚’æ¨™æº–å‡ºåŠ›ã™ã‚‹
- jq ã‚³ãƒãƒ³ãƒ‰ã§ãƒ„ã‚¤ãƒ¼ãƒˆã® id ã‚’æ¨™æº–å‡ºåŠ›ã™ã‚‹
- ã¾ãŸåˆ¥ã® python ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ ID ã‚’æ¨™æº–å…¥åŠ›ã§å—ã‘å–ã£ã¦ã€å‰Šé™¤ã—ã¦ã€APIã‹ã‚‰å—ã‘å–ã£ãŸ json ã‚’æ¨™æº–å‡ºåŠ›ã™ã‚‹
- jq ã‚³ãƒãƒ³ãƒ‰ã§ json ã®å†…å®¹ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦æ¨™æº–å‡ºåŠ›ã™ã‚‹

```
echo "Hello Mr.Twitter " | python twitter/create.py | jq --raw-output '.["id_str"]' | python twitter/destroy.py | jq .
```

# ã‚¤ãƒ¡ãƒ¼ã‚¸

![image](https://user-images.githubusercontent.com/13635059/54872745-8d608d80-4e0c-11e9-91d6-71e60b9b8160.png)

# script - config.py 

```
CONSUMER_KEY = ''
CONSUMER_SECRET = ''
ACCESS_TOKEN = ''
ACCESS_TOKEN_SECRET = ''
```

# script - create.py

```py
# https://developer.twitter.com/en/docs/tweets/post-and-engage/api-reference/post-statuses-update

import json, config, os, re, urllib.parse, unicodedata, sys
from requests_oauthlib import OAuth1Session
 
CK = config.CONSUMER_KEY
CS = config.CONSUMER_SECRET
AT = config.ACCESS_TOKEN
ATS = config.ACCESS_TOKEN_SECRET
twitter = OAuth1Session(CK, CS, AT, ATS)

message = ''

for line in sys.stdin:
  message += re.sub(r'^\s+|\s+$', '', line)

formatted_message = re.sub(r'\\n', "\n", message)

formatted_message = formatted_message[:140]

encoded_message = urllib.parse.quote_plus(formatted_message)

tweet = {
  "status" : encoded_message,
  "in_reply_to_status_id" : os.environ.get('IN_REPLY_TO_STATUS_ID') if os.environ.get('IN_REPLY_TO_STATUS_ID') else '',
  "auto_populate_reply_metadata" : 'true',
}

url = "https://api.twitter.com//1.1/statuses/update.json?status={status}&in_reply_to_status_id={in_reply_to_status_id}&auto_populate_reply_metadata={auto_populate_reply_metadata}".format(**tweet)

if os.environ.get("DEBUG"):
  print(url)
else:
  res = twitter.post(url)
  print(json.dumps(res.json()))
```

# script - destroy.py

```py
# https://developer.twitter.com/en/docs/tweets/post-and-engage/api-reference/post-statuses-destroy-id.html

import json, config, re, sys, os
from requests_oauthlib import OAuth1Session
 
CK = config.CONSUMER_KEY
CS = config.CONSUMER_SECRET
AT = config.ACCESS_TOKEN
ATS = config.ACCESS_TOKEN_SECRET
twitter = OAuth1Session(CK, CS, AT, ATS)

for line in sys.stdin:
  id = line.strip()
  api_url = 'https://api.twitter.com/1.1/statuses/destroy/{id}.json'.format(**{ "id" : id })

  res = twitter.post(api_url)
  print(json.dumps(res.json()))
```

# ã²ã¨ã“ã¨

ãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«é“å…·ã‚’æƒãˆã¦ã€ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚ŠãŸã„ã€‚


- [ã€Œãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€ã«ãªã‚‹ã€‚1å€‹ã®æŠ€è¡“ã«å›ºåŸ·ã—ãªã„ã¨ã„ã†ã“ã¨ã€‚RT @yutakarai @yuki24 - Qiita](https://qiita.com/YumaInaura/items/28c8820d28be13d82a5f)

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‹‰å¼·ä¼šã«å‚åŠ ã—ãªã„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€‚ä¿ºã§ã™ã€‚ã ã‘ã©ä¸€ç•ªè¡Œã£ã¦è‰¯ã‹ã£ãŸã¨æ€ã£ãŸã®ã¯RubyKaigiå¤§é˜ª01ã ã€‚<a href="https://twitter.com/yuki24?ref_src=twsrc%5Etfw">@yuki24</a> ã•ã‚“ã®ç™ºè¡¨ã¯æœ¬å½“ã«é ­ã«æ®‹ã£ã¦ã‚‹ã€‚ãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ä½¿ã„åˆ†ã‘ã‚‹ã€‚ã¡ãªã¿ã«åƒ•ã‚‚LTæ ã§ç™»å£‡ã—ãŸã€‚</p>&mdash; 0 (@YumaInaura) <a href="https://twitter.com/YumaInaura/status/1097573971657134080?ref_src=twsrc%5Etfw">February 18, 2019</a></blockquote> 

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/904








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


