---
title: "Googleç¿»è¨³API  ( #GCP ) ãŒ HTMLç¿»è¨³ã§ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ”¹è¡Œã‚„ã‚‰ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’å£Šã—ã‚„ãŒã‚‹ã®ã§ #python ã§æ³£ãæ³£"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Python", "googlecloud"]
published: true
published_at: 2019-05-06
---

# concept

- `<pre></pre>` ã®ä¸­èº«ã‚’ URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ãŠã
- Googleç¿»è¨³ã«ã‹ã‘ã‚‹
- `<pre></pre>` ã®ä¸­èº«ã‚’ URLãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹

ä»¥ä¸Šã€‚


# python

```py
#!/usr/bin/env python3

# -*- coding: utf-8 -*-

import os, sys, requests, json, fileinput, re, uuid
import urllib.parse

resource_message = sys.stdin.read()

from_language = os.environ.get('FROM') if os.environ.get('FROM') else 'ja'
to_language = os.environ.get('TO') if os.environ.get('TO') else 'en'
translate_format = 'html'

def match_and_encode(match):
  return match.group(1) + urllib.parse.quote(match.group(2)) + match.group(3)

def convert_codeblocks(resource_message):
  resource_message = re.sub(r'(<pre>(?:<code>)?)(.+?)((?:</code>)?</pre>)', match_and_encode, resource_message, flags=re.DOTALL)

  return resource_message

def match_and_decode(match):
  return match.group(1) + urllib.parse.unquote(match.group(2)) + match.group(3)

def revert_codeblocks(resource_message):
  resource_message = re.sub(r'(<pre>(?:<code>)?)(.+?)((?:</code>)?</pre>)', match_and_decode, resource_message, flags=re.DOTALL)

  return resource_message

def google_translate(resource_message):
  data = {
    'q': resource_message,
    'source': from_language,
    'target': to_language,
    'format': translate_format
  }

  url = 'https://translation.googleapis.com/language/translate/v2'
  token = os.environ['TOKEN']

  headers = {
   'Authorization': 'Bearer {}'.format(token),
   'Content-Type': 'application/json',
  }

  res = requests.post(url, headers=headers, json=data)

  return(res.json()['data']['translations'][0]['translatedText'])

resource_message = convert_codeblocks(resource_message)
resource_message = google_translate(resource_message)
resource_message = revert_codeblocks(resource_message)

print(resource_message)
```

# HTML

```
<h1>Title</h1>

plain text

<pre><code>
print('Not translate in codes')
print(1)
print(2)
</code></pre>

plain text

<pre><code>
def ex():
  print(4)
  print(5)
</code></pre>

```

# exe


```
$ cat fixtures/english-codes.html | TOKEN=[GCP_TOKEN] FROM=en TO=ja ./translate-html-raw.py
<h1>ã‚¿ã‚¤ãƒˆãƒ«</h1>å¹³æ–‡<pre> <code>
print('Not translate in codes')
print(1)
print(2)
</code> </pre>å¹³æ–‡<pre> <code>
def ex():
  print(4)
  print(5)
</code> </pre>

```



# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/1660








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-05-06
