---
title: "Ansible 2.6 â€” replace ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ç½®æ›ã™ã‚‹"
emoji: "ğŸ–¥"
type: "idea"
topics: ["Ansible"]
published: true
---

replace module ã‚’ä½¿ã†ã“ã¨ã§ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®æ–‡å­—åˆ—ã‚’ç½®æ›ã§ãã‚‹ã€‚

## ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### åŸºæœ¬

|ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿|èª¬æ˜|
|---|---|
|path|ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹|
|regexp|ãƒãƒƒãƒã•ã›ã‚‹æ­£è¦è¡¨ç¾<br>https://docs.python.org/2/library/re.html<br><br>è¡Œé ­ãƒãƒƒãƒ `^` ã¨è¡Œæœ«ãƒãƒƒãƒ `$`ã‚’ä½¿ã†ã“ã¨ã§1è¡Œã”ã¨ã®ç½®æ›ãŒã§ãã‚‹|
|replace|ç½®æ›å¾Œã®æ–‡å­—åˆ—<br>æŒ‡å®šãªã—ã®å ´åˆã¯ãƒãƒƒãƒã—ãŸæ–‡å­—åˆ—ã‚’å‰Šé™¤ã™ã‚‹|

### å¿œç”¨

|ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿|èª¬æ˜|
|---|---|
|backup|yes ã‚’æŒ‡å®šã—ãŸå ´åˆã¯ç½®æ›å‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå–ã‚‰ã‚Œã‚‹<br>ä¾‹: `people_source.txt.772.2018-08-01@12:00:28~`|
|unsafe_writes|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯noã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ã«ç½®æ›å‡¦ç†ã‚’ãŠã“ãªã†ãŒã€yesã«ã—ã¦éã‚¢ãƒˆãƒŸãƒƒã‚¯ãªå‡¦ç†ã«å¤‰ãˆã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹<br>(ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯dockerã§ã®ãƒã‚¦ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹)|
|encoding|ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿æ›¸ãã™ã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰<br>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ utf-8|

## Playbookã®ä¾‹

```01_replace_playbook.yml
- hosts:
    - localhost

  tasks:
    - name: copy
      copy:
        src: people_source.txt
        dest: people_replaced.txt

    # Replace "Alice" to "Alice is lady" in all line
    - name: replace
      replace:
        path: people_replaced.txt
        regexp: '^Alice$'
        replace: Alice is a lady

    # Replace "Bob (Lastname)" to "Bob (Lastname) is gentleman" in all line
    - name: replace
      replace:
        path: people_replaced.txt
        # () is capture of regular expression
        regexp: '^Bob ([a-zA-Z]+)$'
        # \1 is replaced by first captured strings
        replace: 'Bob \1 is a gentleman'

    - name: check replaced file
      slurp:
        src: people_replaced.txt
      register: replaced_file

    - name: check replaced file body
      debug:
        msg: "{{ replaced_file.content | b64decode }}"
```

## å…ƒãƒ•ã‚¡ã‚¤ãƒ«

```people_source.txt
Alice
Bob Marley
Carol
Alice
Bob Wills
Carol
Alice
Bob Horper
Carol
```


## ç½®æ›å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«

```people_replaced.txt
Alice is a lady
Bob Marley is a gentleman
Carol
Alice is a lady
Bob Wills is a gentleman
Carol
Alice is a lady
Bob Horper is a gentleman
Carol
```


## å®Ÿè¡Œä¾‹

```

PLAY [localhost] **************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************
ok: [localhost]

TASK [copy] *******************************************************************************************************************************
changed: [localhost]

TASK [replace] ****************************************************************************************************************************
changed: [localhost]

TASK [replace] ****************************************************************************************************************************
changed: [localhost]

TASK [check replaced file] ****************************************************************************************************************
ok: [localhost]

TASK [check replaced file body] ***********************************************************************************************************
ok: [localhost] => {
    "msg": "Alice is a lady\nBob Marley is a gentleman\nCarol\nAlice is a lady\nBob Wills is a gentleman\nCarol\nAlice is a lady\nBob Horper is a gentleman\nCarol\n"
}

PLAY RECAP ********************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0   
```

## Gist

- [Ansible2.6â€” replace module example](https://gist.github.com/YumaInaura/592121dd8dc2a71b796591ccc4564f31)

# å‚è€ƒ

- [Ansibleã®æ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« replace(ç½®æ›)ã‚’ä½¿ã£ã¦ã¿ãŸã€‚ - Qiita](https://qiita.com/volanja/items/54a7dbc75b909e89d8fc)
  - Ansible 1.6 ã§ã® module ç™»å ´æ™‚ã®è¨˜äº‹
- [Ansibleâ€”ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’èª­ã‚€ - Qiita](https://qiita.com/YumaInaura/items/6fd98d50067c8f47917a)
- [replace - Replace all instances of a particular string in a file using a back-referenced regular expression. â€” Ansible Documentation](https://docs.ansible.com/ansible/2.6/modules/replace_module.html)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


