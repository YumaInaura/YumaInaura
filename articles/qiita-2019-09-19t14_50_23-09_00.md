---
title: "#AWS SQS ã® Dead Letter Que ã«é€ã‚‰ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ #Ruby ã® shoryuken gem ã® Worker "
emoji: "ğŸ–¥"
type: "tech"
topics: ["Ruby", "AWS"]
published: true
published_at: 2019-09-19
---

- railsé–¢ä¿‚ãªã—
- AWS SQS ã® DeadLetterQue ã«ã¯é€šå¸¸ã®ã‚­ãƒ¥ãƒ¼ã§å‡¦ç†ã«å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ã‚‰ã‚Œã‚‹ãŒã€ãã‚Œã‚’ã•ã‚‰ã«Workerã§å‡¦ç†ã—ã¦ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡å¯èƒ½ã€->ã€Œå‡¦ç†ä¸­ã€->ã€Œå‰Šé™¤ã€ã®çŠ¶æ…‹ã«é·ç§»ã•ã›ã‚‹ã€‚
- ã‚³ãƒãƒ³ãƒ‰ã« -q ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ¥ãƒ¼ã®åå‰ã‚’æŒ‡å®šã—ã¦ã€Worker ã® shoryuken_options ã«ã‚‚åŒã˜ã‚­ãƒ¥ãƒ¼åã‚’æ›¸ã„ã¦ãŠã‹ãªã‘ã‚Œã°ã„ã‘ãªã•ãã†ï¼Ÿ
- ç‰¹ã«ä½•ã‚‚ perform ã§å‡¦ç†ã‚’ã•ã›ãªã„å ´åˆã¯ã€ruby ã® Worker class ã¯è¦ã‚‰ãªãã†

# env

```
export AWS_ACCESS_KEY_ID=YYYYYYYYYY
export AWS_SECRET_ACCESS_KEY=ZZZZZZZZZZZ
export AWS_REGION=us-east-2
```

# AWS console

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§DeadLetterQueã®åå‰ãŒã‚ã‹ã‚‹ (ã“ã„ã¤ã€ã©ã“ã§ç”Ÿã¾ã‚Œã‚‹ã‚“ã ã‚ã†ã€‚æœ€åˆã‹ã‚‰ã‚ã‚‹ã‚“ã ã£ã‘ï¼Ÿ)

![image](https://user-images.githubusercontent.com/13635059/65211462-cd61ae00-dad9-11e9-844f-e03026fc0592.png)


# shoryuken_worker.rb

```rb
class ShoryukenWorker
  include Shoryuken::Worker

  shoryuken_options queue: 'XXX', auto_delete: true

  def perform(sqs_msg, name)
    puts '-' * 100
    puts 'WORKER'
    puts '-' * 100
    puts name
    puts sqs_msg
  end
end
```

# Command

```rb
bundle exec shoryuken -q  XXX --require ./shoryuken_worker.rb
```

# é€ä¿¡ãƒ†ã‚¹ãƒˆ

AWS console ã®ã‚­ãƒ¥ãƒ¼ã®æ“ä½œã§ã€DeadLetterQueã«ã‚‚ç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡å¯èƒ½

![image](https://user-images.githubusercontent.com/13635059/65211438-ac00c200-dad9-11e9-899d-b43c99b77b5e.png)

# Worker ã®çµæœ


![image](https://user-images.githubusercontent.com/13635059/65211448-ba4ede00-dad9-11e9-8dc2-c781f36a92eb.png)


# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2482








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-09-19
