---
title: "#AWS ã§ SQSã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ã‚’ãƒˆãƒªã‚¬ãƒ¼ã« lambda ã§é–¢æ•°ã‚’å®Ÿè¡Œã•ã›ã‚‹æ‰‹é †"
emoji: "ğŸ–¥"
type: "tech"
topics: ["AWS"]
published: true
published_at: 2019-09-21t21:22
---

ã“ã®ä¾‹ã§ã¯lambdaã¨SQSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¡Œãæ¥ã—ã¦ä½œæ¥­ã™ã‚‹

# å‚è€ƒ

æ›¸ã„ãŸå¾Œã«æ°—ã¥ã„ãŸã‘ã©ã€ã“ã¡ã‚‰ã®è¨˜äº‹ãŒãšã£ã¨è©³ã—ã„ã€‚

[AWS LambdaãŒSQSã‚’ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚¹ã¨ã—ã¦ã‚µãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼ ï½œ DevelopersIO](https://dev.classmethod.jp/etc/aws-lambda-support-sqs-event-source/)

# HELP

[AWS Lambda ã‚’ Amazon SQS ã«ä½¿ç”¨ã™ã‚‹ - AWS Lambda](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-sqs.html)

# AWS lambda ãŒ SQS  ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã€å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãŠã

[#AWS Lambda ã®å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ ( SQSã®å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã¦è¦‹ã‚‹ä¾‹ ) Â· Issue #2496 Â· YumaInaura/YumaInaura](https://github.com/YumaInaura/YumaInaura/issues/2496)


# SQSã®ã‚­ãƒ¥ãƒ¼ã‚’ä½œæˆã™ã‚‹

![image](https://user-images.githubusercontent.com/13635059/65371747-cdaca580-dca1-11e9-8f6c-78a35532702a.png)

# Lambda ã®é–¢æ•°ã‚’é¸ã‚“ã§è¨­å®šã«é€²ã‚€

![image](https://user-images.githubusercontent.com/13635059/65371774-0c426000-dca2-11e9-82f4-6f456b9537db.png)

# Lambdaã« SQS ãŒä½¿ãˆã‚‹å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã‚’ä¸ãˆã¦ãŠã

![image](https://user-images.githubusercontent.com/13635059/65371801-54fa1900-dca2-11e9-8552-85a421320ae4.png)


# Lambda ã®è¨­å®šã§ã€Œãƒˆãƒªã‚¬ãƒ¼ã‚’è¿½åŠ ã€ã‚’é¸ã¶

![image](https://user-images.githubusercontent.com/13635059/65371787-2b40f200-dca2-11e9-9e2f-30ae920cb6a1.png)

# ãƒˆãƒªã‚¬ãƒ¼ã« SQSã‚’é¸ã¶

![image](https://user-images.githubusercontent.com/13635059/65371732-af46aa00-dca1-11e9-89e7-d6ca78d8fc34.png)

# SQSã®ã‚­ãƒ¥ãƒ¼ã‚’é¸ã¶

![image](https://user-images.githubusercontent.com/13635059/65371734-ba013f00-dca1-11e9-9d13-4334937c4420.png)

# SQSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ã‚­ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹ã¨ã€LambdaãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹

![image](https://user-images.githubusercontent.com/13635059/65371838-bf12be00-dca2-11e9-8e16-ece79840df87.png)

# SQS ã®ã‚­ãƒ¥ãƒ¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã‚’ã™ã‚‹

ã©ã†ã‚„ã‚‰ä¸€ç¬ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡¦ç†ã•ã‚Œã‚‹ã‚ˆã†ã§ã€ã™ãã«ä¸€è¦§ç”»é¢ã‚’æ›´æ–°ã—ã¦ã‚‚ã€Œåˆ©ç”¨å¯èƒ½ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã®ä»¶æ•°ã•ãˆã€å¢—ãˆã‚‹ã®ã¯åˆ†ã‹ã‚‰ãªã‹ã£ãŸã€‚
ã‚­ãƒ¥ãƒ¼å®Ÿè¡Œã«é…å»¶æ™‚é–“ã‚’ä¸ãˆã¦ã‚„ã‚Œã°ã€å‹•ããŒã‚ã‹ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚

![image](https://user-images.githubusercontent.com/13635059/65371824-8f63b600-dca2-11e9-9d55-d01243736915.png)

![image](https://user-images.githubusercontent.com/13635059/65371817-8672e480-dca2-11e9-9f96-b2656574a9fe.png)

# Lambdaã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° / CloudWatchã®ãƒ­ã‚°ãªã©ã‚’ç¢ºèªã—ã¦ã€å±¥æ­´ã‚’è¦‹ã‚‹

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã€‚

![image](https://user-images.githubusercontent.com/13635059/65372185-aa84f480-dca7-11e9-952e-34d6c241bd91.png)


![image](https://user-images.githubusercontent.com/13635059/65371961-6cd29c80-dca4-11e9-91a2-f18a59547fb0.png)


# Lambdaã§SQSã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã¯ã©ã†ã‚„ã£ã¦æ‰±ã†ã®ï¼Ÿ

Hello world ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã« `event` ã¨ã„ã†è¡¨è¨˜ãŒè¦‹ãˆã‚‹ã€‚
ãã‚‚ãã‚‚å„è¨€èªã§ event ã‚’ç°¡å˜ã«å‚ç…§ã§ãã‚‹ã£ã½ã„ï¼Ÿ

å½“æ–¹LambdaæœªçµŒé¨“è€…ã«ã¤ãã€‚

Ruby ã®ä¾‹

```rb
require 'json'

def lambda_handler(event:, context:)
    # TODO implement
    { statusCode: 200, body: JSON.generate('Hello from Lambda!') }
end
```

# SQSã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã¯ã“ã‚“ãªã‚“

```json
{
    "Records": [
        {
            "messageId": "059f36b4-87a3-44ab-83d2-661975830a7d",
            "receiptHandle": "AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...",
            "body": "test",
            "attributes": {
                "ApproximateReceiveCount": "1",
                "SentTimestamp": "1545082649183",
                "SenderId": "AIDAIENQZJOLO23YVJ4VO",
                "ApproximateFirstReceiveTimestamp": "1545082649185"
            },
            "messageAttributes": {},
            "md5OfBody": "098f6bcd4621d373cade4e832627b4f6",
            "eventSource": "aws:sqs",
            "eventSourceARN": "arn:aws:sqs:us-east-2:123456789012:my-queue",
            "awsRegion": "us-east-2"
        },
        {
            "messageId": "2e1424d4-f796-459a-8184-9c92662be6da",
            "receiptHandle": "AQEBzWwaftRI0KuVm4tP+/7q1rGgNqicHq...",
            "body": "test",
            "attributes": {
                "ApproximateReceiveCount": "1",
                "SentTimestamp": "1545082650636",
                "SenderId": "AIDAIENQZJOLO23YVJ4VO",
                "ApproximateFirstReceiveTimestamp": "1545082650649"
            },
            "messageAttributes": {},
            "md5OfBody": "098f6bcd4621d373cade4e832627b4f6",
            "eventSource": "aws:sqs",
            "eventSourceARN": "arn:aws:sqs:us-east-2:123456789012:my-queue",
            "awsRegion": "us-east-2"
        }
    ]
}
```

[AWS Lambda ã‚’ Amazon SQS ã«ä½¿ç”¨ã™ã‚‹ - AWS Lambda](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-sqs.html)

# SQS ã®ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãŠãã¨ã€ç°¡å˜ã«ãƒ†ã‚¹ãƒˆã§ããã†

![image](https://user-images.githubusercontent.com/13635059/65372610-5c72ef80-dcad-11e9-8b1c-71a0c12dd39b.png)

# Ruby 

ã“ã‚“ãªãƒãƒªï¼Ÿ

```rb
require 'json'

def lambda_handler(event:, context:)
    # TODO implement
    { statusCode: 200, body: JSON.generate(event['Records'][0]['messageId']) }
end

```

# ãƒ†ã‚¹ãƒˆã¯æˆåŠŸ

![image](https://user-images.githubusercontent.com/13635059/65372732-ab6d5480-dcae-11e9-9195-62e97d6fbaac.png)

# JSON ã®å‡ºåŠ›çµæœã®ãƒ­ã‚°ã£ã¦ã©ã“ã§è¦‹ã‚‹ã®ï¼Ÿ

å®¿é¡Œã€‚

# ã¨ã“ã‚ã§ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã§365æ—¥8æ™‚é–“ãšã¤ç¨¼åƒã—ã‚ˆã†ã¨ã—ã¦ãŸã‚‰

ä½“åŠ›ã¯ä½™ã£ã¦ã‚‹ã‚“ã ã‘ã©ã€ç›®ãŒã‹ã™ã‚“ã§ä»•æ–¹ãŒãªã„ã€‚äººé–“ã®ä½“ã£ã¦é›£å„€ã ã€‚

å¤§é˜ªã®å¤œã®è¡—ã‚’ã¼ã‚“ã‚„ã‚Šçœºã‚ã¦ã€è¦–åŠ›å›å¾©ã™ã‚‹ã—ã‹ãªã„ã‹ï¼Ÿ

![image](https://user-images.githubusercontent.com/13635059/65372314-4fec9800-dca9-11e9-838a-c015202443a3.png)

# è‘—è€…è¿‘å½±

![image](https://user-images.githubusercontent.com/13635059/65372333-80343680-dca9-11e9-8996-9027ecd836ae.png)

![image](https://user-images.githubusercontent.com/13635059/65372329-77436500-dca9-11e9-8ee0-162fd275ac06.png)



# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2497








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-09-21
