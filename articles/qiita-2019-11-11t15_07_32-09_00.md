---
title: #Rails ã® ActiveRecord ã§ optional: true ã¯ validates_presence_of ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã®
emoji: "ğŸ–¥"
type: "idea"
topics: ["Rails"]
published: true
---

# Class

```rb
class User < ApplicationRecord
  has_many :books
end
```

```rb
class Book < ApplicationRecord
  belongs_to :user
end
```

# æŒ™å‹•

- Rails 5ã‹ã‚‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ™å‹• ã§ã¯ã€user_id ã‚’æŒãŸãªã„ book ã¯ä½œæˆã§ããªã„
- optional: true ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ user_id ã‚’æŒãŸãªã„ book ã‚’ä½œæˆã§ãã‚‹
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚’æŒãŸãªã„å ´åˆã‚„ `foreign_key: { on_delete: :nullify }` ã®åˆ¶ç´„ã‚’ã¤ã‘ã¦ã„ã‚‹å ´åˆã€ã©ã¡ã‚‰ã®æŒ‡å®šã§ã‚‚ user ã‚’å‰Šé™¤ã§ãã‚‹

ã£ã½ã„ã€‚

ã¡ã‚‡ã£ã¨åˆ†ã‹ã‚Šã¥ã‚‰ã„ã€‚

# ãã®ç†ç”±ã¯

Railsçš„ã« assciation ã® validation ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã¯ã€ãã® class ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ“ä½œæ™‚ã ã‹ã‚‰ã‹ãªã¨æ€ã£ãŸã€‚

ãŸã¨ãˆã° user ãŒå‰Šé™¤ã•ã‚ŒãŸã¨ãã¯ book ã®åˆ¶ç´„ãŒèµ°ã‚‹ã‚ã‘ã§ã¯ãªã„ã‹ã‚‰ã€çš„ãªã€‚

# è¦ªã‚¯ãƒ©ã‚¹ã®æŒ‡å®š

- `dependent: :destroy`
- `dependent: :delete_all`
- `dependent: :nullify`

ã§æŒ™å‹•ã‚’åˆ¶å¾¡ã—ãŸã‚‰è‰¯ã„ã‹ãªã€‚

```rb
class User < ApplicationRecord
  has_many :books, dependent: :nullify
end
```

[Active Record Associations â€” Ruby on Rails Guides](https://guides.rubyonrails.org/association_basics.html#options-for-has-one)

# æœ¬å½“ã«ï¼Ÿ

ã¾ã ã¾ã å¥¥æ·±ã„Railsã®æ£®ã®å¥¥æ·±ãã€‚

# å‚è€ƒ

[optional: trueã£ã¦ãªã« - Qiita](https://qiita.com/ryoryomaru/items/7e401f9600fb11c20215)

[Rails5ã‹ã‚‰belongs_toé–¢é€£ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§required: trueã«ãªã‚‹ - Qiita](https://qiita.com/iguchi1124/items/218e35a145f372062ea4)

[ActiveRecord::Associations::ClassMethods](https://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-belongs_to)

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2708








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


