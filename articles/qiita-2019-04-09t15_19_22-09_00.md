---
title: "#GCP ã® Google ç¿»è¨³ #API ã‚’å©ã #python ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹ã€‚ #JSON ã‚’æ¨™æº–å…¥åŠ›ã«ä¸ãˆã‚‹ã¨ ç¿»è¨³çµæœã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä»˜"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Python", "API", "JSON", "googlecloud"]
published: true
---

# å‰æ

- gcloud ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã“ã¨
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã‚‹ã“ã¨
- Google Translate API ã‚„ã‚‰ã®è¨­å®šãŒæ¸ˆã‚“ã§ã„ã‚‹ã“ã¨

ref [googleç¿»è¨³ yumanaura - Google Search](https://www.google.com/search?q=google%E7%BF%BB%E8%A8%B3+yumanaura&oq=google%E7%BF%BB%E8%A8%B3+yumanaura&aqs=chrome..69i57.3403j0j7&sourceid=chrome&ie=UTF-8)

# ./get-token.sh

ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§ãƒŠã‚¦ã§ãƒ¤ãƒ³ã‚°ãª Access Token  ã‚’å¾—ã‚‹ç°¡å˜ãªã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```
GOOGLE_APPLICATION_CREDENTIALS=~/.secret/google-service-credential.json gcloud auth application-default print-access-token
```

# ./translate-json.py

- æ¨™æº–å…¥åŠ›ã§ json ã‚’ä¸ãˆã‚‹ 
- json ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æƒ³å®š
- ç¿»è¨³ã—ãŸã„json çš„ãªã‚­ãƒ¼ã‚’ ç’°å¢ƒå¤‰æ•° TRANSLATE_JSON_KEY ã§æ¸¡ã™

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os, sys, requests, json, fileinput, re

json_lines = sys.stdin.read()

from_language = os.environ.get('FROM') if os.environ.get('FROM') else 'ja'
to_language = os.environ.get('TO') if os.environ.get('TO') else 'en'

token = os.environ['TOKEN']
translate_json_key = os.environ['TRANSLATE_JSON_KEY']

headers = {
 'Authorization': 'Bearer {}'.format(token),
 'Content-Type': 'application/json',
}
 
api_url = 'https://translation.googleapis.com/language/translate/v2'

results = []

for line in json.loads(json_lines):
  params = {
    'q': line[translate_json_key],
    'source': from_language,
    'target': to_language,
    'format': 'text'
  }
 
  res = requests.post(api_url, headers=headers, json=params)

  translated_text = res.json()['data']['translations'][0]['translatedText']

  line["translated_text"] = translated_text

  results.append(line) 
 
print(json.dumps(results))
```


# exe

```
$ echo '[{"text":"æ´‹æ¢¨", "owner": "Yuma"}, {"text" : "ã‚Šã‚“ã”", "owner" : "Inaura"}]' | TOKEN=$(./get-token.sh) TRANSLATE_JSON_KEY=text ./translate-json.py | jq .
```

```json
[
  {
    "text": "æ´‹æ¢¨",
    "owner": "Yuma",
    "translated_text": "Pear"
  },
  {
    "text": "ã‚Šã‚“ã”",
    "owner": "Inaura",
    "translated_text": "Apple"
  }
]
```

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/1131








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


