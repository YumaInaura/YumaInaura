---
title: "#django REST framework ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã® Googleæ—¥æœ¬èªç¿»è¨³ ( Tutorial 1: Serializatio"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Django"]
published: true
---

# Ref

https://www.django-rest-framework.org/tutorial/1-serialization

<h1 id="tutorial-1-serialization"> <a class="toclink" href="#tutorial-1-serialization">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«1ï¼šç›´åˆ—åŒ–</a> </h1><h2 id="introduction"> <a class="toclink" href="#introduction">å‰æ›¸ã</a> </h2><p>ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Web APIã‚’å¼·èª¿ã™ã‚‹å˜ç´”ãªãƒšãƒ¼ã‚¹ãƒˆãƒ“ãƒ³ã‚³ãƒ¼ãƒ‰ã®ä½œæˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ãã®éç¨‹ã§ã€RESTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã™ã‚‹ã•ã¾ã–ã¾ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç´¹ä»‹ã—ã€ã™ã¹ã¦ãŒã©ã®ã‚ˆã†ã«çµ„ã¿åˆã‚ã•ã£ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ã®åŒ…æ‹¬çš„ãªç†è§£ã‚’å¾—ã¾ã™ã€‚ </p><p>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã‹ãªã‚Šè©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€å§‹ã‚ã‚‹å‰ã«ãŠãã‚‰ãã‚ãªãŸã¯ã‚¯ãƒƒã‚­ãƒ¼ã¨ã‚ãªãŸã®å¤§å¥½ããªã‚³ãƒƒãƒ—ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã¹ãã§ã™ã€‚ç°¡å˜ãªæ¦‚è¦ã‚’çŸ¥ã‚ŠãŸã„ã ã‘ã®å ´åˆã¯ã€ä»£ã‚ã‚Šã«<a href="../quickstart/">ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã®</a>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ </p><hr /><p> <strong>æ³¨</strong> ï¼šã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¯ã€GitHubã®<a href="https://github.com/encode/rest-framework-tutorial">encode / rest-framework-tutorial</a>ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚å®Œæˆã—ãŸå®Ÿè£…ã¯ã€ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç‰ˆã¨ã—ã¦ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚‚<a href="https://restframework.herokuapp.com/">å…¥æ‰‹ã§ãã¾ã™</a> ã€‚ <a href="https://restframework.herokuapp.com/">ã“ã¡ã‚‰</a>ã‹ã‚‰<a href="https://restframework.herokuapp.com/">å…¥æ‰‹ã§ãã¾ã™</a> ã€‚ </p><hr /><h2 id="setting-up-a-new-environment"> <a class="toclink" href="#setting-up-a-new-environment">æ–°ã—ã„ç’°å¢ƒã‚’è¨­å®šã™ã‚‹</a> </h2><p>ä»–ã®ã“ã¨ã‚’ã™ã‚‹å‰ã«ã€ <a href="http://www.virtualenv.org/en/latest/index.html">virtualenv</a>ã‚’ä½¿ã£ã¦æ–°ã—ã„ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ç§é”ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆãŒç§é”ãŒå–ã‚Šçµ„ã‚“ã§ã„ã‚‹ä»–ã®ã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚‚ãã¡ã‚“ã¨éš”é›¢ã•ã‚Œã¦ä¿ãŸã‚Œã‚‹ã®ã‚’ç¢ºå®Ÿã«ã™ã‚‹ã§ã—ã‚‡ã†ã€‚ </p><pre><code>virtualenv env
source env/bin/activate
</code></pre> <p>ã“ã‚Œã§virtualenvç’°å¢ƒã«å…¥ã£ãŸã®ã§ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¦ä»¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚ </p><pre><code>pip install django
pip install djangorestframework
pip install pygments  # We'll be using this for the code highlighting
</code></pre> <p> <strong>æ³¨ï¼š</strong> virtualenvç’°å¢ƒã‚’ã„ã¤ã§ã‚‚çµ‚äº†ã™ã‚‹ã«ã¯ã€ <code>deactivate</code> ã€‚è©³ã—ãã¯<a href="http://www.virtualenv.org/en/latest/index.html">virtualenvã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’</a>å‚ç…§ã—ã¦ãã ã•ã„ã€‚ </p><h2 id="getting-started"> <a class="toclink" href="#getting-started">å…¥é–€</a> </h2><p>ã•ã¦ã€ã“ã‚Œã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å§‹ã‚ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚ã¯ã˜ã‚ã«ã€ä½œæ¥­ã™ã‚‹æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ </p><pre><code>cd ~
django-admin startproject tutorial
cd tutorial
</code></pre> <p>ã“ã‚ŒãŒå®Œäº†ã—ãŸã‚‰ã€å˜ç´”ãªWeb APIã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œæˆã§ãã¾ã™ã€‚ </p><pre><code>python manage.py startapp snippets
</code></pre> <p>æ–°ã—ã„<code>snippets</code>ã‚¢ãƒ—ãƒªã¨<code>rest_framework</code>ã‚¢ãƒ—ãƒªã‚’<code>INSTALLED_APPS</code>ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ <code>tutorial/settings.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã—ã‚‡ã†ã€‚ </p><pre><code>INSTALLED_APPS = (
    ...
    'rest_framework',
    'snippets.apps.SnippetsConfig',
)
</code></pre> <p>ã•ã¦ã€ç§ãŸã¡ã¯ãƒ­ãƒ¼ãƒ«ã®æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚ </p><h2 id="creating-a-model-to-work-with"> <a class="toclink" href="#creating-a-model-to-work-with">ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹</a> </h2><p>ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ç›®çš„ã®ãŸã‚ã«ã€ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹å˜ç´”ãª<code>Snippet</code>ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚ã•ã‚ã€ <code>snippets/models.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚æ³¨ï¼šè‰¯ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ–¹æ³•ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒã‚¸ãƒˆãƒªç‰ˆã«ã¯ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ã‚³ãƒ¼ãƒ‰è‡ªä½“ã«ç„¦ç‚¹ã‚’çµã‚‹ãŸã‚ã«çœç•¥ã—ã¦ã„ã¾ã™ã€‚ </p><pre><code>from django.db import models
from pygments.lexers import get_all_lexers
from pygments.styles import get_all_styles

LEXERS = [item for item in get_all_lexers() if item[1]]
LANGUAGE_CHOICES = sorted([(item[1][0], item[0]) for item in LEXERS])
STYLE_CHOICES = sorted((item, item) for item in get_all_styles())


class Snippet(models.Model):
    created = models.DateTimeField(auto_now_add=True)
    title = models.CharField(max_length=100, blank=True, default='')
    code = models.TextField()
    linenos = models.BooleanField(default=False)
    language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)
    style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)

    class Meta:
        ordering = ('created',)
</code></pre> <p>ã¾ãŸã€ã‚¹ãƒ‹ãƒšãƒƒãƒˆãƒ¢ãƒ‡ãƒ«ã®åˆæœŸç§»è¡Œã‚’ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆã‚ã¦åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ </p><pre><code>python manage.py makemigrations snippets
python manage.py migrate
</code></pre> <h2 id="creating-a-serializer-class"> <a class="toclink" href="#creating-a-serializer-class">ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚¯ãƒ©ã‚¹ã®ä½œæˆ</a> </h2><p>ç§ãŸã¡ãŒWeb APIã‚’å§‹ã‚ã‚‹ãŸã‚ã«æœ€åˆã«å¿…è¦ãªã“ã¨ã¯ã€ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’<code>json</code>ã‚ˆã†ãªè¡¨ç¾ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã™ã€‚ Djangoã®ãƒ•ã‚©ãƒ¼ãƒ ã¨éå¸¸ã«ã‚ˆãä¼¼ãŸåƒãã‚’ã™ã‚‹ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’å®£è¨€ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’å®Ÿç¾ã§ãã¾ã™ã€‚ <code>snippets</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«<code>serializers.py</code>ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚ </p><pre><code>from rest_framework import serializers
from snippets.models import Snippet, LANGUAGE_CHOICES, STYLE_CHOICES


class SnippetSerializer(serializers.Serializer):
    id = serializers.IntegerField(read_only=True)
    title = serializers.CharField(required=False, allow_blank=True, max_length=100)
    code = serializers.CharField(style={'base_template': 'textarea.html'})
    linenos = serializers.BooleanField(required=False)
    language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default='python')
    style = serializers.ChoiceField(choices=STYLE_CHOICES, default='friendly')

    def create(self, validated_data):
        """
        Create and return a new `Snippet` instance, given the validated data.
        """
        return Snippet.objects.create(**validated_data)

    def update(self, instance, validated_data):
        """
        Update and return an existing `Snippet` instance, given the validated data.
        """
        instance.title = validated_data.get('title', instance.title)
        instance.code = validated_data.get('code', instance.code)
        instance.linenos = validated_data.get('linenos', instance.linenos)
        instance.language = validated_data.get('language', instance.language)
        instance.style = validated_data.get('style', instance.style)
        instance.save()
        return instance
</code></pre> <p>ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚¯ãƒ©ã‚¹ã®æœ€åˆã®éƒ¨åˆ†ã¯ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®šç¾©ã—ã¾ã™ã€‚ <code>create()</code>ãŠã‚ˆã³<code>update()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ <code>serializer.save()</code>å‘¼ã³å‡ºã™ã¨ãã«ã€å®Œå…¨ã«æº–å‚™ã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã©ã®ã‚ˆã†ã«ä½œæˆã¾ãŸã¯å¤‰æ›´ã•ã‚Œã‚‹ã‹ã‚’å®šç¾©ã—ã¾ã™ã€‚ </p><p>ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚¯ãƒ©ã‚¹ã¯Django <code>Form</code>ã‚¯ãƒ©ã‚¹ã¨éå¸¸ã«ã‚ˆãä¼¼ã¦ãŠã‚Šã€ <code>required</code> ã€ <code>max_length</code> ã€ <code>default</code>ãªã©ã®ã•ã¾ã–ã¾ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åŒæ§˜ã®æ¤œè¨¼ãƒ•ãƒ©ã‚°ãŒå«ã¾ã‚Œã¦ã„<code>default</code> ã€‚ </p><p>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ãƒ©ã‚°ã¯ã€HTMLã¸ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ãªã©ã€ç‰¹å®šã®çŠ¶æ³ã§ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã®è¡¨ç¤ºæ–¹æ³•ã‚‚åˆ¶å¾¡ã§ãã¾ã™ã€‚ä¸Šè¨˜ã®<code>{&#39;base_template&#39;: &#39;textarea.html&#39;}</code>ãƒ•ãƒ©ã‚°ã¯Django <code>Form</code>ã‚¯ãƒ©ã‚¹ã§<code>widget=widgets.Textarea</code>ã‚’ä½¿ã†ã®ã¨åŒã˜ã§ã™ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®å¾ŒåŠã§è¦‹ã‚‹ã‚ˆã†ã«ã€ã“ã‚Œã¯ãƒ–ãƒ©ã‚¦ã‚ºå¯èƒ½ãªAPIãŒã©ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã‹ã‚’åˆ¶å¾¡ã™ã‚‹ã®ã«ç‰¹ã«å½¹ã«ç«‹ã¡ã¾ã™ã€‚ </p><p> <code>ModelSerializer</code>ã™ã‚‹ã‚ˆã†ã«ã€ <code>ModelSerializer</code>ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦å®Ÿéš›ã«æ™‚é–“ã‚’ç¯€ç´„ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ã“ã“ã§ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶å®šç¾©ã‚’æ˜ç¤ºçš„ã«ã—ã¦ãŠãã¾ã™ã€‚ </p><h2 id="working-with-serializers"> <a class="toclink" href="#working-with-serializers">ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã®ä½¿ç”¨</a> </h2><p>å…ˆã«é€²ã‚€å‰ã«ã€æ–°ã—ã„Serializerã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ Djangoã‚·ã‚§ãƒ«ã«å…¥ã‚Šã¾ã—ã‚‡ã†ã€‚ </p><pre><code>python manage.py shell
</code></pre> <p>ã•ã¦ã€ã„ãã¤ã‹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒé‚ªé­”ã«ãªã‚‰ãªããªã£ãŸã‚‰ã€ãã‚Œã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ã„ãã¤ã‹ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ </p><pre><code>from snippets.models import Snippet
from snippets.serializers import SnippetSerializer
from rest_framework.renderers import JSONRenderer
from rest_framework.parsers import JSONParser

snippet = Snippet(code='foo = "bar"\n')
snippet.save()

snippet = Snippet(code='print("hello, world")\n')
snippet.save()
</code></pre> <p>ã“ã‚Œã§ã„ãã¤ã‹ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†ç”Ÿã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®1ã¤ã‚’ç›´åˆ—åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ </p>


<pre><code>serializer = SnippetSerializer(snippet)
serializer.data
# {'id': 2, 'title': '', 'code': 'print("hello, world")\n', 'linenos': False, 'language': 'python', 'style': 'friendly'}
</code></pre> <p>ã“ã®æ™‚ç‚¹ã§ã€ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’Pythonã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ã«å¤‰æ›ã—ã¾ã—ãŸã€‚ç›´åˆ—åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Œæˆã•ã›ã‚‹ãŸã‚ã«ã€ãƒ‡ãƒ¼ã‚¿ã‚’<code>json</code>ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ </p><pre><code>content = JSONRenderer().render(serializer.data)
content
# b'{"id": 2, "title": "", "code": "print(\\"hello, world\\")\\n", "linenos": false, "language": "python", "style": "friendly"}'
</code></pre> <p>é€†ã‚·ãƒªã‚¢ãƒ«åŒ–ã‚‚åŒæ§˜ã§ã™ã€‚ã¾ãšã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’Pythonã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ã«è§£æã—ã¾ã™ã€‚ </p><pre><code>import io

stream = io.BytesIO(content)
data = JSONParser().parse(stream)
</code></pre> <p> ...ãã—ã¦ã€ãã‚Œã‚‰ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®Œå…¨ã«ç§»å…¥ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¾©å…ƒã—ã¾ã™ã€‚ </p><pre><code>serializer = SnippetSerializer(data=data)
serializer.is_valid()
# True
serializer.validated_data
# OrderedDict([('title', ''), ('code', 'print("hello, world")\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])
serializer.save()
# &lt;Snippet: Snippet object&gt;
</code></pre> <p> APIãŒãƒ•ã‚©ãƒ¼ãƒ ã‚’æ“ä½œã™ã‚‹ã®ã«ä¼¼ã¦ã„ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’ä½¿ç”¨ã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã‚’æ›¸ãå§‹ã‚ã‚‹ã¨ã€é¡ä¼¼æ€§ãŒã•ã‚‰ã«æ˜ã‚‰ã‹ã«ãªã‚Šã¾ã™ã€‚ </p><p>ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä»£ã‚ã‚Šã«ã‚¯ã‚¨ãƒªã‚»ãƒƒãƒˆã‚’ã‚·ãƒªã‚¢ãƒ«åŒ–ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãã®ãŸã‚ã«ã¯ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã®å¼•æ•°ã«<code>many=True</code>ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚ </p><pre><code>serializer = SnippetSerializer(Snippet.objects.all(), many=True)
serializer.data
# [OrderedDict([('id', 1), ('title', ''), ('code', 'foo = "bar"\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', ''), ('code', 'print("hello, world")\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', ''), ('code', 'print("hello, world")'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]
</code></pre> <h2 id="using-modelserializers"> <a class="toclink" href="#using-modelserializers">ModelSerializerã‚’ä½¿ç”¨ã™ã‚‹</a> </h2><p>ç§ãŸã¡ã®<code>SnippetSerializer</code>ã‚¯ãƒ©ã‚¹ã¯<code>Snippet</code>ãƒ¢ãƒ‡ãƒ«ã«ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ãŸãã•ã‚“ã®æƒ…å ±ã‚’è¤‡è£½ã—ã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã†å°‘ã—ç°¡æ½”ã«ã—ã¦ãŠãã¨ã„ã„ã§ã—ã‚‡ã†ã€‚ </p><p> DjangoãŒ<code>Form</code>ã‚¯ãƒ©ã‚¹ã¨<code>ModelForm</code>ã‚¯ãƒ©ã‚¹ã®ä¸¡æ–¹ã‚’æä¾›ã™ã‚‹ã®ã¨åŒã˜ã‚ˆã†ã«ã€RESTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯<code>Serializer</code>ã‚¯ãƒ©ã‚¹ã¨<code>ModelSerializer</code>ã‚¯ãƒ©ã‚¹ã®ä¸¡æ–¹ã‚’<code>ModelSerializer</code>ã¾ã™ã€‚ </p><p> <code>ModelSerializer</code>ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ãŸ<code>ModelSerializer</code>ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ•ã‚¡ã‚¤ãƒ«<code>snippets/serializers.py</code>ã‚‚ã†ä¸€åº¦é–‹ãã€ <code>SnippetSerializer</code>ã‚¯ãƒ©ã‚¹ã‚’æ¬¡ã®ã‚ˆã†ã«ç½®ãæ›ãˆã¾ã™ã€‚ </p><pre><code>class SnippetSerializer(serializers.ModelSerializer):
    class Meta:
        model = Snippet
        fields = ('id', 'title', 'code', 'linenos', 'language', 'style')
</code></pre> <p>ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã®å„ªã‚ŒãŸç‰¹æ€§ã®1ã¤ã¯ã€ãã®è¡¨ç¾ã‚’å°åˆ·ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ <code>python manage.py shell</code>ã§Djangoã‚·ã‚§ãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚ </p><pre><code>from snippets.serializers import SnippetSerializer
serializer = SnippetSerializer()
print(repr(serializer))
# SnippetSerializer():
#    id = IntegerField(label='ID', read_only=True)
#    title = CharField(allow_blank=True, max_length=100, required=False)
#    code = CharField(style={'base_template': 'textarea.html'})
#    linenos = BooleanField(required=False)
#    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...
#    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...
</code></pre> <p> <code>ModelSerializer</code>ã‚¯ãƒ©ã‚¹ã¯ç‰¹ã«é­”æ³•ã®ã‚ˆã†ãªã“ã¨ã¯ã—ãªã„ã“ã¨ã‚’è¦šãˆã¦ãŠãã“ã¨ãŒé‡è¦ã§ã™ã€‚ãã‚Œã‚‰ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®å˜ãªã‚‹ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ã™ã€‚ </p><ul><li>è‡ªå‹•çš„ã«æ±ºå®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚»ãƒƒãƒˆã€‚ </li><li> <code>create()</code>ãŠã‚ˆã³<code>update()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã®å˜ç´”ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…</li></ul><h2 id="writing-regular-django-views-using-our-serializer"> <a class="toclink" href="#writing-regular-django-views-using-our-serializer">ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’ä½¿ã£ã¦é€šå¸¸ã®Djangoãƒ“ãƒ¥ãƒ¼ã‚’æ›¸ã</a> </h2><p>æ–°ã—ã„Serializerã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦APIãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ç¾æ™‚ç‚¹ã§ã¯ã€RESTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãã®ä»–ã®æ©Ÿèƒ½ã¯ä¸€åˆ‡ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚é€šå¸¸ã®Djangoãƒ“ãƒ¥ãƒ¼ã¨ã—ã¦ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ </p><p> <code>snippets/views.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚ </p><pre><code>from django.http import HttpResponse, JsonResponse
from django.views.decorators.csrf import csrf_exempt
from rest_framework.parsers import JSONParser
from snippets.models import Snippet
from snippets.serializers import SnippetSerializer
</code></pre> <p>ç§ãŸã¡ã®APIã®æ ¹åº•ã«ã‚ã‚‹ã®ã¯ã€æ—¢å­˜ã®ã™ã¹ã¦ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ã“ã¨ã€ã¾ãŸã¯æ–°ã—ã„ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚ </p><pre><code>@csrf_exempt
def snippet_list(request):
    """
    List all code snippets, or create a new snippet.
    """
    if request.method == 'GET':
        snippets = Snippet.objects.all()
        serializer = SnippetSerializer(snippets, many=True)
        return JsonResponse(serializer.data, safe=False)

    elif request.method == 'POST':
        data = JSONParser().parse(request)
        serializer = SnippetSerializer(data=data)
        if serializer.is_valid():
            serializer.save()
            return JsonResponse(serializer.data, status=201)
        return JsonResponse(serializer.errors, status=400)
</code></pre> <p> CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒãŸãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã“ã®ãƒ“ãƒ¥ãƒ¼ã«POSTã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã®ã§ã€ãƒ“ãƒ¥ãƒ¼ã‚’<code>csrf_exempt</code>ã¨ã—ã¦ãƒãƒ¼ã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚ãªãŸãŒé€šå¸¸ã‚„ã‚ŠãŸã„ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€ãã—ã¦RESTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ“ãƒ¥ãƒ¼ã¯å®Ÿéš›ã«ã“ã‚Œã‚ˆã‚Šè³¢æ˜ãªæŒ¯ã‚‹èˆã„ã‚’ä½¿ç”¨ã—ã¾ã™ã€ã—ã‹ã—ãã‚Œã¯ä»Šç§ãŸã¡ã®ç›®çš„ã®ãŸã‚ã«ã™ã‚‹ã§ã—ã‚‡ã†ã€‚ </p><p>å€‹ã€…ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã«å¯¾å¿œã—ã€ã‚¹ãƒ‹ãƒšãƒƒãƒˆã®å–å¾—ã€æ›´æ–°ã€å‰Šé™¤ã«ä½¿ç”¨ã§ãã‚‹ãƒ“ãƒ¥ãƒ¼ã‚‚å¿…è¦ã§ã™ã€‚ </p><pre><code>@csrf_exempt
def snippet_detail(request, pk):
    """
    Retrieve, update or delete a code snippet.
    """
    try:
        snippet = Snippet.objects.get(pk=pk)
    except Snippet.DoesNotExist:
        return HttpResponse(status=404)

    if request.method == 'GET':
        serializer = SnippetSerializer(snippet)
        return JsonResponse(serializer.data)

    elif request.method == 'PUT':
        data = JSONParser().parse(request)
        serializer = SnippetSerializer(snippet, data=data)
        if serializer.is_valid():
            serializer.save()
            return JsonResponse(serializer.data)
        return JsonResponse(serializer.errors, status=400)

    elif request.method == 'DELETE':
        snippet.delete()
        return HttpResponse(status=204)
</code></pre> <p>æœ€å¾Œã«ã€ã“ã‚Œã‚‰ã®è¦‹è§£ã‚’çµã³ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ <code>snippets/urls.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ </p><pre><code>from django.urls import path
from snippets import views

urlpatterns = [
    path('snippets/', views.snippet_list),
    path('snippets/&lt;int:pk&gt;/', views.snippet_detail),
]
</code></pre> <p>ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®URLã‚’å«ã‚ã‚‹ã«ã¯ã€ <code>tutorial/urls.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ãƒ«ãƒ¼ãƒˆã®urlconfã‚‚é…ç·šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ </p><pre><code>from django.urls import path, include

urlpatterns = [
    path('', include('snippets.urls')),
]
</code></pre> <p>ç¾æ™‚ç‚¹ã§é©åˆ‡ã«å¯¾å‡¦ã—ã¦ã„ãªã„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒã„ãã¤ã‹ã‚ã‚‹ã“ã¨ã¯æ³¨ç›®ã«å€¤ã—ã¾ã™ã€‚ä¸æ­£ãªå½¢å¼ã®<code>json</code>ã‚’é€ä¿¡ã—ãŸå ´åˆã€ã¾ãŸã¯ãƒ“ãƒ¥ãƒ¼ãŒå‡¦ç†ã—ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã§è¦æ±‚ãŒè¡Œã‚ã‚ŒãŸå ´åˆã¯ã€500ã€Œã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã€ã®å¿œç­”ãŒè¿”ã•ã‚Œã¾ã™ã€‚ãã‚Œã§ã‚‚ã€ã“ã‚Œã¯ä»Šã®ã¨ã“ã‚ã—ã¾ã™ã€‚ </p><h2 id="testing-our-first-attempt-at-a-web-api"> <a class="toclink" href="#testing-our-first-attempt-at-a-web-api">Web APIã§ã®æœ€åˆã®è©¦ã¿ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹</a> </h2><p>ã“ã‚Œã§ã€ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’æ‰±ã†ã‚µãƒ³ãƒ—ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã§ãã¾ã™ã€‚ </p><p>ã‚·ã‚§ãƒ«ã‚’çµ‚äº†ã—ã¾ã™... </p><pre><code>quit()
</code></pre> <p> ...ãã—ã¦Djangoã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚ </p><pre><code>python manage.py runserver

Validating models...

0 errors found
Django version 1.11, using settings 'tutorial.settings'
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre> <p>åˆ¥ã®ç«¯æœ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚ </p><p> <a href="https://curl.haxx.se/">curl</a>ã¾ãŸã¯<a href="https://github.com/jakubroztocil/httpie#installation">httpie</a>ã‚’ä½¿ã£ã¦APIã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚ Httpieã¯Pythonã§æ›¸ã‹ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªhttpã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã™ã€‚ãã‚Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚ </p><p>ã‚ãªãŸã¯pipã‚’ä½¿ã£ã¦httpieã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ </p><pre><code>pip install httpie
</code></pre> <p>æœ€å¾Œã«ã€ã™ã¹ã¦ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã§ãã¾ã™ã€‚ </p><pre><code>http http://127.0.0.1:8000/snippets/

HTTP/1.1 200 OK
...
[
  {
    "id": 1,
    "title": "",
    "code": "foo = \"bar\"\n",
    "linenos": false,
    "language": "python",
    "style": "friendly"
  },
  {
    "id": 2,
    "title": "",
    "code": "print(\"hello, world\")\n",
    "linenos": false,
    "language": "python",
    "style": "friendly"
  }
]
</code></pre> <p>ã‚ã‚‹ã„ã¯ã€ãã®IDã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’å–å¾—ã§ãã¾ã™ã€‚ </p><pre><code>http http://127.0.0.1:8000/snippets/2/

HTTP/1.1 200 OK
...
{
  "id": 2,
  "title": "",
  "code": "print(\"hello, world\")\n",
  "linenos": false,
  "language": "python",
  "style": "friendly"
}
</code></pre> <p>åŒæ§˜ã«ã€Webãƒ–ãƒ©ã‚¦ã‚¶ã§ã“ã‚Œã‚‰ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚åŒã˜JSONã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚ </p>

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/1662








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


