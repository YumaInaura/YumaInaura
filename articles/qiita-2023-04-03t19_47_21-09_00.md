---
title: Rails â€“ ä»Šæ›´ã ã‘ã© credentials.yml.enc / secret_key_base ã®æ‰±ã„ãŒã‚ˆãåˆ†ã‹ã£ã¦ãªã‹ã£ãŸ
emoji: "ğŸ–¥"
type: "idea"
topics: ["Rails"]
published: true
---

# ã¤ãªãŒã‚Š

- `credentials.yml.enc` ã§ã©ã‚“ãªå€¤ã§ã‚‚æš—å·åŒ–/è¤‡åˆã§ãã‚‹
- `master.key` ã®å€¤ã§ `credentials.yml.enc` ã‚’è¤‡åˆå‡ºæ¥ã‚‹
- `secret_key_base` ã¯ç§˜å¯†æƒ…å ±ãªã®ã§ `credentials.yml.enc` ã«å«ã‚ã¦ãŠãã®ãŒè‰¯ã„

ã¨ã„ã†ã“ã¨ã‚‰ã—ã„

#  rails new

ãã‚‚ãã‚‚ rails new ã—ãŸæ™‚ã« 

- `config/credentials.yml.enc`
- `config/master.key`

ãŒã‚»ãƒƒãƒˆã§ç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã 

`master.key` ã¯ãŸã å¾©å·ç”¨ã®å€¤ã‚’è¨˜éŒ²ã—ãŸã ã‘ã®ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã ãŒã€ã“ã®å€¤ãŒã‚ã‚Œã° `credentials.yml.enc` ã‚’è¤‡åˆã—ãŸã‚Šç·¨é›†ã—ãŸã‚Šå‡ºæ¥ã‚‹

ã ãŒ `master.key` ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ gitæ“ä½œã§æ¶ˆãˆã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã ã‚ã†

# ç·¨é›†

`bin/rails credentials:edit` ã§ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ãŒå‡ºæ¥ã‚‹ã¯ãšãªã®ã ãŒæ€’ã‚‰ã‚ŒãŸ

-  `master.key` ãŒãªã„ã®ã§è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚ŒãŸ
- `config/credentials.yml.enc` ã‚’æš—å·åŒ–ã—ãŸã®ã¯åˆ¥ã® `master.key` ã ã£ãŸã®ã§è¤‡åˆã¯å‡ºæ¥ãªã„

ã¨ã„ã†ã“ã¨ã¿ãŸã„ã 

```
EDITOR=vi bin/rails credentials:edit
Adding config/master.key to store the encryption key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Save this in a password manager your team can access.

If you lose the key, no one, including you, can access anything encrypted with it.

      create  config/master.key

Couldn't decrypt config/credentials.yml.enc. Perhaps you passed the wrong key?
```

credentials ã®ç·¨é›†ãŒåˆã‚ã¦ã®å ´åˆã¯  credentials ã‚’å‰Šé™¤ã—ã¦ã‚„ã‚Šç›´ã—ã¦ã—ã¾ãŠã†

```
rm config/credentials.yml.enc
EDITOR=vi bin/rails credentials:edit
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ãƒ³ãƒ—ãƒ¬å†…å®¹ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ãã®ã¾ã¾ä¿å­˜ã—ã¦ã¿ã‚‹

```
# aws:
#   access_key_id: 123
#   secret_access_key: 345

# Used as the base secret for all MessageVerifiers in Rails, including the one protecting cookies.
secret_key_base: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

# å†ç·¨é›†

ã“ã‚Œã§æº–å‚™ãŒæ•´ã£ãŸ
`master.key` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°ã“ã®ã¾ã¾ç·¨é›†ã—ç¶šã‘ã‚‰ã‚Œã‚‹ã€‚

```
EDITOR=vi bin/rails credentials:edit
```

`master.key` ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡ãã¦ã‚‚ç’°å¢ƒå¤‰æ•°ã§å€¤æŒ‡å®šã™ã‚Œã°è¤‡åˆãƒ»ç·¨é›†ãŒå¯èƒ½ã 

```
RAILS_MASTER_KEY=yyyyyyyyyyyyyyyy EDITOR=vi bin/rails credentials:edit
```

# ç·¨é›†ã§ããªã„å ´åˆ

ã‚¨ãƒ‡ã‚£ã‚¿æŒ‡å®šãŒå¤‰ã ã¨ã‚¨ãƒ©ãƒ¼ã‚‚ãªãçµ‚äº†ã—ã¦ã—ã¾ã†ã‚ˆã†ã 

```
EDITOR=waaaaaaa bin/rails credentials:edit
File encrypted and saved.
```


# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ


# Twitter

https://twitter.com/YumaInaura

