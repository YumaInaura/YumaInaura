---
title: #Rails + shoryuken gem + #AWS SQS ã§ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã®å‹•ä½œç¢ºèªã‚’ã™ã‚‹
emoji: "ğŸ–¥"
type: "idea"
topics: ["Rails", "AWS"]
published: true
---

# ãƒ©ãƒ³ãƒ€ãƒ ã«å¤±æ•—ã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’ä½œã£ã¦ãŠã

```rb
class ShoryukenRandomFailureJob < ApplicationJob
  queue_as :example1
  queue_as :example2

  def perform(message)
    if rand(1..3) <= 1
      puts '-' * 100
      puts 'JOB WOKED'
      puts '-' * 100
      puts "message: #{message}"
      puts '-' * 100
    else
      raise 'Job Failed'
    end
  end
end
```

# ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹

```
bundle exec rails runner 'ShoryukenRandomFailureJob.perform_later("ABC")'
```

# Workerã§ä¾‹å¤–ãŒç¢ºèªã§ãã‚‹

![image](https://user-images.githubusercontent.com/13635059/65002437-c0ed2200-d92e-11e9-8ae3-5737b7657929.png)

# AWS SQS ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å‡¦ç†ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¢—ãˆã‚‹

![image](https://user-images.githubusercontent.com/13635059/65002436-bf235e80-d92e-11e9-9c5a-a5c602c4a6a4.png)


# ã„ãšã‚Œã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã™ã‚‹

![image](https://user-images.githubusercontent.com/13635059/65002476-f560de00-d92e-11e9-8fae-2864f842bd26.png)

# WorkerãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ = ã‚¸ãƒ§ãƒ–ã‚’è‡ªå‹•å‰Šé™¤ã—ã¦ã€å‡¦ç†ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ãŒ0ã«ãªã‚‹


![image](https://user-images.githubusercontent.com/13635059/65002496-0dd0f880-d92f-11e9-976c-82c10cbe24cd.png)

ãŸã ã— shoryuken worker ã®è¨­å®šã§è‡ªå‹•å‰Šé™¤ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã‚‹å ´åˆã«é™ã‚‹

```rb
class ShoryukenWorker
  include Shoryuken::Worker

  shoryuken_options queue: 'example1', auto_delete: true
  shoryuken_options queue: 'example2', auto_delete: true
  shoryuken_options queue: 'example3', auto_delete: true
end
```

# NOTE

- shoryukençš„ã«ãƒªãƒˆãƒ©ã‚¤ã‚’ã—ã¦ã„ã‚‹ã‹ã€SQSçš„ã«ãƒªãƒˆãƒ©ã‚¤ã‚’ã—ã¦ã„ã‚‹ã‹ã¯ã¾ã ä¸æ˜

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2464








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


