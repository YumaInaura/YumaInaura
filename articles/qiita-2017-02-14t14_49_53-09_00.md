---
title: "Rspec â€” åƒ•ã®çŸ¥ã‚‰ãªã‹ã£ãŸRspec"
emoji: "ğŸ–¥"
type: "idea"
topics: ["Ruby", "Rails", "RSpec"]
published: true
---

æ™®æ®µã‚ã¾ã‚Šä½¿ã£ã¦ã„ãªã„ã‚‚ã®ã‚’ã¾ã¨ã‚ã¦ã¿ãŸã€‚

# subjectã‚’æ›¸ã‹ãªã„

è¶…åŸºæœ¬ã ãŒã€æ™®é€šã«çŸ¥ã‚‰ãªã‹ã£ãŸã€‚
describe ã«ç›´æ¥ subject ã®å†…å®¹ã‚’æ›¸ã‘ã‚‹ã€‚

```rb
describe 1 do
  it { is_expected.to eq 1 }
end
```

# start_with / end_with ãƒãƒƒãƒãƒ£

å§‹ã¾ã‚Šã‚„çµ‚ã‚ã‚Šã‚’æ¤œè¨¼ã§ãã‚‹ã€‚(ã©ã‚“ãªæ™‚ã«ä½¿ã†ã‚“ã ã‚ã†ï¼Ÿ)

```rb
describe "ABC" do
  it { is_expected.to start_with 'A' }
  it { is_expected.to end_with 'C' }
  it { is_expected.not_to start_with 'X' }
  it { is_expected.not_to end_with 'Z' }

  # ç¢ºã‹ã«æ­£è¦è¡¨ç¾ã‚ˆã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ã‚¿ãƒ–ãƒ«ã§ã¯ã‚ã‚‹
  it { is_expected.to match /^A/ }
  it { is_expected.to match /B$/ }
  it { is_expected.not_to match /^X/ }
  it { is_expected.not_to match /Z$/ }
end
```

[In My Opinion]

é…åˆ—ã®å§‹ã¾ã‚Šã‚„çµ‚ã‚ã‚Šã‚‚ã€åŒã˜ãƒãƒƒãƒãƒ£ã§æ¤œè¨¼ã§ãã‚‹ã¨ã“ã‚ãŒã‚¤ã‚¤ã€‚

```rb
describe 'DAY' do
  subject { [:MORNING, :MIDDAY, :NIGHT] }

  it { is_expected.to start_with :MORNING }

  it { is_expected.to end_with :NIGHT }
end
```

å¯¾è±¡ãŒæ–‡å­—åˆ—ã ã‚ã†ãŒé…åˆ—ã ã‚ã†ãŒé–¢ä¿‚ãªã„ã€‚
ã€Œãƒ†ã‚¹ãƒˆãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ã‚¿ãƒ–ãƒ«ã§ã‚ã‚‹ã“ã¨ã€ã®ä¸€ç«¯ãŒã‚ã‚‰ã‚ã‚Œã¦ã„ã‚‹ã¨æ€ã†ã€‚

ã“ã‚ŒãŒã‚‚ã— `start_string_with` / `start_array_with` ã¨ã‹ã„ã†åå‰ã ã£ãŸã‚‰ã€æ¤œè¨¼è¡¨ç¾ã§ã¯ãªãã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çš„è¡¨ç¾ã«ãªã£ã¦ã—ã¾ã†æ°—ãŒã™ã‚‹ã€‚
ãƒ†ã‚¹ãƒˆã®è¡¨ç¾ã«ã¯ã‚ãã¾ã§ã€ŒæŒ™å‹•ã€ã‚’è¨˜è¿°ã—ãŸã„ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å†…ã®çŠ¶æ…‹ã‚’è¡¨ç¾ã—ãŸã„ã‚ã‘ã§ã¯ãªã„ã€ã¨ã„ã†æ„Ÿã˜ã‚’å—ã‘ãŸã€‚

( `match_array` ã¨ã»ã¼åŒã˜å‹•ãã‚’ã™ã‚‹ `contain_exactly` ãŒå‡ºã¦ããŸã®ã‚‚ã€Œå¯¾è±¡ãŒé…åˆ—ã‹ã©ã†ã‹ãªã‚“ã¦ã€é–¢ä¿‚ã­ãƒ¼ã‚ˆã€ã£ã¦ã„ã†æ„å›³ãŒã‚ã‚‹ã‚“ã˜ã‚ƒãªã„ã ã‚ã†ã‹ )

# eql ãƒãƒƒãƒãƒ£

eq ã¯å†…éƒ¨çš„ã« `==` ã§ã®æ¯”è¼ƒã‚’ãŠã“ãªã†ãŒã€eql ã¯ `eql?` ã§ã®æ¯”è¼ƒã‚’ãŠã“ãªã†ã€‚

```rb
describe 1.0 do
  # 1.0 == 1 ã¯ true
  it { is_expected.to eq 1 }

  # 1.0.eql? 1 ã¯ false
  it { is_expected.not_to eql 1 }
end
```

å‚è€ƒ: [Ruby ã®æ–‡å­—åˆ—æ¯”è¼ƒ [eql?, equal?, ==, ===] ã®ä½¿ã„åˆ†ã‘ã‚’æ±—è‡­ãèª¬æ˜ #ruby](http://qiita.com/tbpgr/items/a1f231999910cd48ec58)


# be ãƒãƒƒãƒãƒ£

ä»Šã¾ã§ `eq` ã® ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã ã¨æ€ã£ã¦ã„ãŸãŒã€å†…éƒ¨çš„ã«ã¯ `equal?` ã§æ¯”è¼ƒã‚’ãŠã“ãªã†ã‚ˆã†ã ã€‚


```rb
describe do
  # åŒã˜æ–‡å­—åˆ—ã¯ eq ã§ãƒãƒƒãƒã™ã‚‹
  it { expect('ABC').to eq 'ABC' }

  # åŒã˜æ–‡å­—åˆ—ã ãŒé•ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ be ã§ã¯ãƒãƒƒãƒã—ãªã„
  it { expect('ABC').not_to be 'ABC' }
end
```


# cover ãƒãƒƒãƒãƒ£

ç¯„å›²ã®ä¸­ã«ã€å€¤ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã®ãƒ†ã‚¹ãƒˆãŒå‡ºæ¥ã‚‹ã€‚

## æ•°å€¤

```rb
describe (1..10) do
  # æ•´æ•°
  it { is_expected.to cover 1 }
  it { is_expected.to cover 10 }

  # å°æ•°ç‚¹ã‚‚å—ã‘ä»˜ã‘ã‚‹
  it { is_expected.to cover 1.0 }
  it { is_expected.to cover 10.0 }

  it { is_expected.not_to cover 0.9 }
  it { is_expected.not_to cover 10.1 }
end
```

## æ—¥ä»˜

```rb
describe Time.now - 60 .. Time.now + 60 do

  # æ—¥ä»˜ã‚‚æ¤œè¨¼ã§ãã‚‹
  it { is_expected.to cover Time.now }

  it { is_expected.not_to cover Time.now - 70 }
  it { is_expected.not_to cover Time.now + 70 }
end

```

# and / or


ã„ãã¤ã‹ã®æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›ã¦æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

```rb
describe 'ABC' do
  # and
  it { is_expected.to start_with('A').and include('B').and end_with('C') }

  # or
  it { is_expected.to eq('ABC').or eq('XYZ') }
end
```

ã‚ã‚“ã¾ã‚Šè¤‡é›‘ãªæ¡ä»¶ã§ã¯æ¤œè¨¼ã§ããªã„æ§˜å­ã€‚
ãŸã¨ãˆã° `A and Not B` ã¨ã‹  `not A and B` ã¨ã‹ã„ã†ã®ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã€‚

Rspec ã‚‚ã€Œä½¿ãˆãã†ãªã®ã«ä½¿ãˆãªã„ã€ã¨ã„ã†ã“ã¨ã‚’å¿ƒå¾—ã¦ã„ã‚‹ã®ã‹ã€è¦ªåˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã—ã¦ãã‚Œã‚‹ã€‚

```rb
describe 'ABC' do
  it { is_expected.not_to start_with('X').and end_with('C') }

  # NotImplementedError:
  #      `expect(...).not_to matcher.and matcher` is not supported, since it creates a bit of an ambiguity. Instead, define negated versions of whatever matchers you wish to negate with `RSpec::Matchers.define_negated_matcher` and use `expect(...).to matcher.and matcher`.

  it { is_expected.to start_with('A').and.not_to end_with('X') }

  # ArgumentError:
  # wrong number of arguments (given 0, expected 1)
end
```

# satisfy ãƒãƒƒãƒãƒ£

ã•ã¦ãƒã™ãµãã„ã€‚
ãƒ–ãƒ­ãƒƒã‚¯ã«è‡ªåˆ†ã§åˆ¤å®šã‚’æ›¸ã‘ã‚‹ï¼ è‡ªç”±åº¦ãŒé«˜ãã†ã€‚

ã“ã‚Œã‚’ä½¿ãˆã°ã€å…ˆç¨‹ã§ããªã‹ã£ãŸ `A and not B` ã¿ãŸã„ãªãƒãƒƒãƒã‚‚ã€ç„¡ç†ã‚„ã‚Šæ›¸ã‘ãªã„ã“ã¨ã¯ãªã„ã€‚(ä½•ã®æ„å‘³ãŒã‚ã‚‹ã‹ã¯åˆ†ã‹ã‚‰ãªã„ãŒ)



```rb
describe 'A' do
  it { is_expected.to eq('A').and satisfy { |string| string != 'X' } }
end
```


# ãƒãƒƒãƒãƒ£ã®çµ„ã¿åˆã‚ã›

ãƒãƒƒãƒãƒ£ã®ä¸­ã«ãƒãƒƒãƒãƒ£ã‚’æ›¸ã‘ã‚‹ï¼

## é…åˆ—ã®é †åº

```rb
describe [[:A,:B], [:X, :Y]] do
 # contain_exactly ã§ã¯é…åˆ—ã®é †ç•ªã‚’è€ƒæ…®ã—ãªã„
 # ãªã®ã§ã€Œå¤–å´ã®é…åˆ—ã€ã®é †ç•ªãŒé•ã£ã¦ã‚‚ãƒãƒƒãƒã™ã‚‹
 it do
  is_expected.to contain_exactly(
   [:X, :Y],
   [:A, :B]
  )
 end

 # ã“ã®æ›¸ãæ–¹ã§ã¯ã€Œå†…å´ã®é…åˆ—ã€ã®é †åºãŒé•ã†ã¨ãƒãƒƒãƒã—ãªã„
 it do
  is_expected.not_to contain_exactly(
   [:Y, :X],
   [:B, :A]
  )
 end

 # ãƒãƒƒãƒãƒ£ã‚’çµ„ã¿åˆã‚ã›ã‚Œã°ã€Œå†…å´ã®é…åˆ—ã€ãŒé †åºãŒé•ã£ã¦ã‚‚ãƒãƒƒãƒã™ã‚‹
 # contain_exactly ã®ä¸­ã§ã€ã•ã‚‰ã« contain_exactly ã§ãƒãƒƒãƒã‚’ãŠã“ãªã†
 it do
  is_expected.to contain_exactly(
   contain_exactly(:Y, :X),
   contain_exactly(:B, :A)
  )
  end

 # ã€Œå¤–å´ã®é…åˆ—ã€ã®é †åºã¯è€ƒæ…®ã—ã€ã ãŒã€Œå†…å´ã®é…åˆ—ã€ã®é †åºã¯è€ƒæ…®ã—ãªã„å ´åˆ
 it do
  is_expected.to match([
   contain_exactly(:B, :A),
   contain_exactly(:Y, :X)
  ])
  end

 # ã€Œå¤–å´ã®é…åˆ—ã€ã®é †åºã¯è€ƒæ…®ã›ãšã€ã ãŒã€Œå¤–å´ã®é…åˆ—ã€ã®é †åºã¯è€ƒæ…®ã—ãªã„å ´åˆ
 it do
  is_expected.to contain_exactly(
   match([:X, :Y]),
   match([:A, :B])
  )
  end
end
```

# æ¤œè¨¼å†…å®¹ã‚’çµ„ã¿ç«‹ã¦ã‚‹

Rspec ã£ã¦ DSL ã£ã½ãè¦‹ãˆã‚‹ã‘ã©ã€Rubyçš„ã«è‰²ã€…ã¨å·¥å¤«ã—ã¦DSLã£ã½ãè¦‹ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã‚‹ã ã‘ã€ã¨ã„ã†ç†è§£ã‚’ã—ã¦è‰¯ã„ã‚“ã ã‚ã†ã‹ã€‚
ã¤ã¾ã‚Šã¯ãƒ¡ã‚½ãƒƒãƒ‰+å¼•æ•°ã‚’ã†ã¾ãæ¸¡ã›ã°å‹•ã„ã¦ã—ã¾ã†ã€‚

```rb
# æ¤œè¨¼å†…å®¹è‡ªä½“ã‚‚ã€let ã§å®šç¾©ã§ãã‚‹ ( è‰¯ã—æ‚ªã—ã¯ã•ã¦ãŠã )
describe [1,2,3] do
  describe do
    # to ã®å¾Œã«æ¸¡ã™ã®ã¯è¦ã™ã‚‹ã«å¼•æ•°ãªã®ã§
    # ãƒãƒƒãƒãƒ£åã™ã‚‰ç›´æ¥ã¯æ›¸ã‹ãªãã¦ã‚‚è‰¯ã„ã£ã½ã„
    # ãŸã ã—ã¾ã£ãŸããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ã‚¿ãƒ–ãƒ«ã§ãªããªã£ã¦ã—ã¾ã†ã®ã§ã€ã‚„ã‚ãŸæ–¹ãŒè‰¯ã„
    let(:expect_matches) { match([1,2,3]) }
    it { is_expected.to(expect_matches) }
  end

  # let ã®ä¸­ã§ ãƒãƒƒãƒã®å†…å®¹ã‚’çµ„ã¿ç«‹ã¦ã¦ã€ã•ã‚‰ã«ãã‚Œã‚’ãƒãƒƒãƒãƒ£ã«æ¸¡ã™æ›¸ãæ–¹
  describe do
    let(:expect_equals) { [eq(1),eq(2),eq(3)] }
    it { is_expected.to match(expect_equals) }
  end
end
```

# have_attributes

## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã®æ¯”è¼ƒã®å•é¡Œ

ActiveRecord ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã‚’æ¯”è¼ƒã—ãŸå ´åˆã€ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚­ãƒ¼ã•ãˆåŒã˜ãªã‚‰ true ãŒè¿”ã£ã¦ãã¦ã—ã¾ã†ã€‚
Rspec ã‚’æ›¸ãæ™‚ã€æ„å¤–ã«è½ã¨ã—ç©´ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã ã‚ã†ã‹ã€‚

```rb
require 'rails_helper'

RSpec.describe User, type: :model do
  describe 'eq' do
    subject { User.new(id: 1, name: 'Alice') }

    # name ã¯é•ã†ãŒ id ãŒåŒã˜ãªã®ã§ãƒãƒƒãƒã—ã¦ã—ã¾ã†
    it { is_expected.to eq User.new(id: 1, name: 'Bob') }
  end

  describe 'include' do
    subject { [User.new(id: 1, name: 'Alice')] }

    # name ã¯é•ã†ãŒ id ãŒåŒã˜ãªã®ã§ãƒãƒƒãƒã—ã¦ã—ã¾ã†
    it { is_expected.to include User.new(id: 1, name: 'Bob') }
  end
end
```


=> [Ruby on Rails | ActiveRecord ã§ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã‚’==ã§æ¯”è¼ƒã—ãŸå ´åˆã€å…¨å±æ€§ãŒåŒå€¤ã‹ã©ã†ã‹ã¯æ¤œè¨¼ã—ãªã„](http://qiita.com/YumaInaura/items/f8b946127f6ec888bbaf)


## åŒå€¤æ€§ã‚’æ¤œè¨¼ã—ã‚ˆã†

have_attributes ãªã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã§ã¯ãªãã€å„å±æ€§ã®åŒå€¤æ€§ã‚’æ¤œè¨¼ã§ãã‚‹ã€‚

```rb
require 'rails_helper'

RSpec.describe User, type: :model do
  describe 'have_attributes' do
    subject { User.new(id: 1, first_name: 'Alice', last_name: 'Liddel') }

    # ã‚­ãƒ¼ã‚’çœç•¥ã—ãŸå ´åˆã¯ã€ãã‚Œã‚’ç„¡è¦–ã—ã¦ãƒãƒƒãƒã‚’æ¤œè¨¼ã—ã¦ãã‚Œã‚‹
    # ã“ã®ãŸã‚ã€ä¸€éƒ¨ã®ã‚­ãƒ¼ã«å¯¾ã—ã¦ã ã‘ã®æ¤œè¨¼ã‚’ãŠã“ãªã†ã“ã¨ãŒå‡ºæ¥ã‚‹
    # ãŸã¨ãˆã° have_attributes ã« last_name ã‚’æ¸¡ã•ãªã„å ´åˆã¯ã€last_name ã®æ¤œè¨¼ã¯ãŠã“ãªã‚ãªã„
    it { is_expected.to have_attributes(id: 1) }
    it { is_expected.to have_attributes(id: 1, first_name: 'Alice') }
    it { is_expected.to have_attributes(id: 1, first_name: 'Alice', last_name: 'Liddel') }

    # ã‚­ãƒ¼ã‚’æ¸¡ã—ã€ãªãŠã‹ã¤å€¤ãŒé•ã†å ´åˆã¯ã€ãƒãƒƒãƒã¯å¤±æ•—ã™ã‚‹
    # it { is_expected.to have_attributes(id: 1, first_name: 'Alice', last_name: 'Pleasance') }

    # expected #<User id: 1, name: nil, created_at: nil, updated_at: nil, first_name: "Alice", last_name: "Liddel"> to have attributes {:id => 1, :first_name => "Alice", :last_name => "Pleasance"} but had attributes {:id => 1, :first_name => "Alice", :last_name => "Liddel"}
    # Diff:
    # @@ -1,4 +1,4 @@
    #  :first_name => "Alice",
    #  :id => 1,
    # -:last_name => "Pleasance",
    # +:last_name => "Liddel",
  end
end
```

## `not_to have_attributes` ã®è¬


å…ˆç¨‹æ›¸ã„ãŸã€ã“ã®è½ã¡ã‚‹ãƒ†ã‚¹ãƒˆã€‚

```rb
# ã‚­ãƒ¼ã‚’æ¸¡ã—ã€ãªãŠã‹ã¤å€¤ãŒé•ã†å ´åˆã¯ã€ãƒãƒƒãƒã¯å¤±æ•—ã™ã‚‹
it { is_expected.to have_attributes(id: 1, first_name: 'Alice', last_name: 'Pleasance') }
```

ã€Œ`to` ã§è½ã¡ã‚‹ã‹ã‚‰ã«ã¯ `not_to` ã«ã™ã‚Œã°é€šã‚‹ã ã‚ã†ã€ã¨æ€ã„ãã‚„ã€ã“ã¡ã‚‰ã‚‚è½ã¡ã¦ã—ã¾ã†ã€‚

```rb
# it { is_expected.not_to have_attributes(id: 1, first_name: 'Alice', last_name: 'Pleasance') }

# Failure/Error: it { is_expected.not_to have_attributes(id: 1, first_name: 'Alice', last_name: 'Pleasance') }
#       expected #<User id: 1, name: nil, created_at: nil, updated_at: nil, first_name: "Alice", last_name: "Liddel"> not to have attributes {:id => 1, :first_name => "Alice", :last_name => "Pleasance"}
```



`not_to have_attributes` ã®ãƒãƒƒãƒã§ã¯ã€ã€Œè¨˜è¿°ã—ãŸå…¨ã¦ã®å€¤ãŒç•°ãªã‚‹å ´åˆã€ã«ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã£ã½ã„ã€‚
ã€Œã²ã¨ã¤ã®å€¤ã ã‘ãŒé•ã†ã€å ´åˆã«ã¯ã€ãƒ†ã‚¹ãƒˆè‡ªä½“ãŒè½ã¡ã‚‹ã‚ˆã†ã ã€‚(åˆ†ã‹ã‚Šã«ãã„)

```rb
RSpec.describe User, type: :model do
  describe 'have_attributes' do
    subject { User.new(id: 1, first_name: 'Alice', last_name: 'Liddel') }

    # id ã¨ first_name ã¨ last_name ãŒå…¨ã¦é•ã†ãŸã‚ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
    it { is_expected.not_to have_attributes(id: 2, first_name: 'Bob', last_name: 'Pleasance') }

    # last_name ãŒç•°ãªã‚‹ãŒã€id ã¨ first_name ãŒåŒã˜ãªã®ã§ã€ãƒ†ã‚¹ãƒˆãŒè½ã¡ã‚‹ 
    # it { is_expected.not_to have_attributes(id: 1, first_name: 'Alice', last_name: 'Pleasance') }
  end
end
```

## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã«å¯¾ã—ã¦ã€(å„å±æ€§ã®)åŒå€¤æ€§ã‚’æ¤œè¨¼ã—ãŸã„

`User.all` ã¨ã‹ã®å†…å®¹ã‚’æ¤œè¨¼ã—ãŸã„å ´åˆã€ å˜ç´”ã« `have_attributes` ã¯ä½¿ãˆãªã„ã€‚
ã‹ã¨è¨€ã£ã¦ `contain_exactly` ã‚’ä½¿ã†ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã® `==` ã§ã®æ¯”è¼ƒã«ãªã£ã¦ã—ã¾ã†ã€‚

ã“ã®å ´åˆã€å‹•çš„ã«ãƒãƒƒãƒãƒ£ã‚’çµ„ã¿ç«‹ã¦ã‚‹äº‹ã‚‚ã§ãã‚‹ã€‚

```rb
require 'rails_helper'

RSpec.describe User, type: :model do
  describe 'multiple have_attributes' do
    subject { User.all }

    # åå­—ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹
    let!(:users) do
      [
       User.create(first_name: 'Alice'),
       User.create(first_name: 'Bob'),
       User.create(first_name: 'Carol')
      ]
    end

    # ã€Œå…¨å“¡åˆ†ã®ãƒ•ãƒ«ãƒãƒ¼ãƒ ã€ã‚’æœŸå¾…ã™ã‚‹ãƒãƒƒãƒãƒ£ã®ãƒªã‚¹ãƒˆã‚’ä½œã‚‹
    let(:expect_full_names) do
      users.map do |user|
        have_attributes(first_name: user.first_name, last_name: 'Liddel')
      end
    end

    # expect_full_names ã«ã¯ã€Rspec ã®ãƒãƒƒãƒç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé…åˆ—ã«åã‚ã‚‰ã‚ŒãŸçŠ¶æ…‹ã«ãªã‚‹
    # => [#<RSpec::Matchers::BuiltIn::HaveAttributes:0x007f9b0fef9690
    #   @expected={:first_name=>"Alice", :last_name=>"Liddel"},
    #   @negated=false,
    #   @respond_to_failed=false,
    #   @values={}>,
    #  #<RSpec::Matchers::BuiltIn::HaveAttributes:0x007f9b0fef9528
    #   @expected={:first_name=>"Bob", :last_name=>"Liddel"},
    # ..

    # å…¨å“¡ã«åå­—ã‚’ä»˜ã‘ã‚‹
    before do
      User.update_all(last_name: 'Liddel')
    end

    # å‹•çš„ã«ç”Ÿæˆã—ãŸãƒãƒƒãƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€ã•ã‚‰ã«ãƒãƒƒãƒãƒ£ã«ä¸ãˆã‚‹
    # ã“ã†ã—ã¦ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã€å…¨ä½“ã‚’æ¤œè¨¼ã™ã‚‹
    it { is_expected.to contain_exactly(*expect_full_names) }
  end
end
```

ãŸã ãƒãƒƒãƒå†…å®¹è‡ªä½“ã‚’ `let` ã§ä½œã‚‹ã®ã¯æ°—æŒã¡æ‚ªã„ã®ã§ã€å®Ÿéš›ã«ã¯ãƒãƒƒãƒãƒ£ã®ä¸­ã§ç›´æ¥å±•é–‹ã—ãŸæ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

```rb
it do
  is_expected.to contain_exactly(*
    users.map do |user|
      have_attributes(first_name: user.first_name, last_name: 'Liddel')
    end
  )
end
```

## include + have_attributes

åˆã‚ã›ã¦ä½¿ãˆã‚‹ã€‚

```rb
require 'rails_helper'

RSpec.describe User, type: :model do
  describe 'include have_attributes' do
    subject { User.all }

    # ã¿ã‚“ãªã§éŠã¼ã†
    let!(:users) do
      [
       User.create(first_name: 'Alice'),
       User.create(first_name: 'Bob'),
       User.create(first_name: 'Carol'),
       User.create(first_name: 'Dave')
      ]
    end

    # ãƒœãƒ–ã¨ã‚­ãƒ£ãƒ­ãƒ«ã¯ã„ã‚‹ã‚ˆ
    it 'includes' do
      is_expected.to include(
        have_attributes(first_name: 'Bob'),
        have_attributes(first_name: 'Carol')
      )
    end

    # ã‚¨ãƒªãƒƒã‚¯ã¨ãƒ•ãƒ©ãƒ³ã‚¯ã¯ã„ãªã„ã‚ˆ
    it 'does not include' do
      is_expected.not_to include(
        have_attributes(first_name: 'Eric'),
        have_attributes(first_name: 'Frank')
      )
    end

    # ã‚¢ãƒªã‚¹ã¯ã„ã‚‹ã‘ã©ã‚¨ãƒªãƒƒã‚¯ã¯ãªã„ã‚ˆ ( FAILURE )
    #   expected #<ActiveRecord::Relation [#<User id: 1, name: nil, created_at: "2017-02-14 06:16:39", updated_at: "20..._at: "2017-02-14 06:16:39", updated_at: "2017-02-14 06:16:39", first_name: "Dave", last_name: nil>]> to include (have attributes {:first_name => "Eric"})
    #  Diff:
    #   -[(have attributes {:first_name => "Alice"}),
    #   - (have attributes {:first_name => "Eric"})]
    #
    #  it 'includes' do
    #   is_expected.to include(
    #     have_attributes(first_name: 'Alice'),
    #     have_attributes(first_name: 'Eric')
    #   )
    # end

    # ã‚¨ãƒªãƒƒã‚¯ã¯ã„ãªã„ã‘ã©ã‚¢ãƒªã‚¹ã¯ã„ã‚‹ã‚ˆ ( FAILURE )
    # expected #<ActiveRecord::Relation [#<User id: 1, name: nil, created_at: "2017-02-14 06:16:39", updated_at: "20..._at: "2017-02-14 06:16:39", updated_at: "2017-02-14 06:16:39", first_name: "Dave", last_name: nil>]> not to include (have attributes {:first_name => "Alice"})
    #
    # Diff:
    # -[(have attributes {:first_name => "Alice"),
    # - (have attributes {:first_name => "Eric"})]    it 'does not include' do
    # it 'does not include' do
    #   is_expected.not_to include(
    #     have_attributes(first_name: 'Alice'),
    #     have_attributes(first_name: 'Eric')
    #   )
    end
  end
end
```

## æŸ”è»Ÿãª have_attributes

ã¡ãªã¿ã«ã“ã® have_attributeï½“ ã¯ã¡ã‚‡ã£ã¨æŸ”è»Ÿã«å‡ºæ¥ã¦ã„ã¦ã€åŒå€¤æ¤œè¨¼ä»¥å¤–ã®ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã€‚

```rb
  describe 'progressive have_attributes' do
    subject { User.new(first_name: 'Alice') }

    it { is_expected.to have_attributes(first_name: start_with('A')) }
    it { is_expected.to have_attributes(first_name: include('lic')) }
    it { is_expected.to have_attributes(first_name: end_with('e')) }

    # have_attributes ã®ä¸­ã§ã‚‚ and / or æ¡ä»¶ã‚’æ›¸ã‘ã‚‹
    it do
       is_expected.to have_attributes(
         first_name: (start_with('A').and include('lic').and end_with('e'))
       )
     end
   end
  end
```

# ç’°å¢ƒ

- rspec-rails (3.5.2)
- Rails 5.0.1

# å‚è€ƒ

- https://relishapp.com/rspec/rspec-expectations/docs/compound-expectations
- https://relishapp.com/rspec/rspec-expectations/docs/define-negated-matcher
- https://www.relishapp.com/rspec/rspec-expectations/docs/built-in-matchers/have-attributes-matcher
- http://qiita.com/tbpgr/items/a1f231999910cd48ec58









<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


