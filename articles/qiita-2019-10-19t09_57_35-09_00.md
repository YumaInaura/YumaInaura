---
title: "Dockerfile ã® FROM AS ( multi-stage build ) ã§è¤‡æ•°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦æœ¬ç•ªãƒ»é–‹ç™ºç’°å¢ƒãªã©ã‚’åˆ‡ã‚Šæ›¿ãˆ"
emoji: "ğŸ–¥"
type: "idea"
topics: ["Docker"]
published: true
---

# Dockerfile

- curl ã ã‘å…¥ã£ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã« curl-only ã¨ã„ã†åå‰ã‚’ã¤ã‘ã‚‹
- curl-only ã‚’å…ƒã« vim ã‚‚å…¥ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ curl-with-vim ã¨ã†åå‰ã‚’ã¤ã‘ã‚‹

```
from alpine:3.10.2 AS curl-only
run apk add curl

from curl-only AS curl-with-vim
run apk add vim
```

# build

- `--target` ã« AS ã§ã¤ã‘ãŸåå‰ã‚’æŒ‡å®šã—ã¦ docker build ã™ã‚‹

```
docker build --target=curl-only -t production .

docker build --target=curl-with-vim -t development .
```

```
$ docker images
REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE
development                               latest              d26a7ed31fc2        11 seconds ago      36MB
production                                latest              6ad1165a2fe5        24 seconds ago      8.34MB
```

# docker run

alpineæœ¬ä½“ã«ã¯curlã‚‚vimã‚‚ãªã„

```
$ docker run -it alpine:3.10.2 ash
/ # curl
ash: curl: not found
/ # vim
ash: vim: not found

```

production image ã«ã¯ curl ã¯ã‚ã‚‹ãŒ vim ã¯ãªã„

```
$ docker run -it production ash
/ # curl
curl: try 'curl --help' or 'curl --manual' for more information
/ # vim
ash: vim: not found
/ #
```

development image ã«ã¯ curl ã‚‚ vim ã‚‚ã‚ã‚‹

```
$ docker run -it development ash
/ # curl
curl: try 'curl --help' or 'curl --manual' for more information
/ # vim
```

![image](https://user-images.githubusercontent.com/13635059/67132936-918b4700-f245-11e9-8d9c-0bc0f45af9c7.png)


# docker-compose

ver 3.4 ä»¥ä¸Šã§ target ãŒæŒ‡å®šã§ãã‚‹æ§˜å­

```yml
version: "3.7"
services:
  some:
    build: 
      context: .
      target: curl-with-vim
```

```
docker-compose build

docker-compose run some

vim
```

# Dockerfile ã®æ¡ˆ

AS ã«ç’°å¢ƒåã‚’ã¤ã‘ã¦ã—ã¾ã£ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„

```
from alpine:3.10.2 AS production
run apk add curl

from production AS development
run apk add vim
```

```
docker build --target=production -t production .
docker build --target=development -t production .
```



# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2601








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


