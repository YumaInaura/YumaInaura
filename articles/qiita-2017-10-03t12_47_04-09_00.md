---
title: "Docker | å…¬é–‹éµã§ã‚³ãƒ³ãƒ†ãƒŠã«sshæ¥ç¶šã™ã‚‹å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹Dockerfileã®ä¾‹"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Linux", "Ubuntu", "åˆå¿ƒè€…", "Docker"]
published: true
---

# è§£èª¬

dockerã ã‹ã‚‰ã¨ã„ã£ã¦ç‰¹åˆ¥ãªã“ã¨ã‚’ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã§sshæ¥ç¶šã§ãã‚‹è¨­å®šãªã©ã‚’ãŠã“ãªã„ã€å…¬é–‹éµã‚’è¨­ç½®ã™ã‚‹ã€‚

# å‹•ä½œä¾‹ ( Ubuntu ã®å ´åˆ )

## Dockerfile

```bash:Dockerfile
FROM ubuntu:16.04

RUN apt-get update && apt-get install -y openssh-server
RUN mkdir /var/run/sshd

# sshè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸æ›ãˆ
RUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config

# SSH login fix. Otherwise user is kicked off after login
RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd

ENV NOTVISIBLE "in users profile"
RUN echo "export VISIBLE=now" >> /etc/profile

# æ‰‹å…ƒã®å…¬é–‹éµã‚’ã‚³ãƒ”ãƒ¼
COPY id_rsa.pub /root/authorized_keys

# sshç”¨ã® port ã‚’æ™’ã™
EXPOSE 22

# å…¬é–‹éµã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ (ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³å¤‰æ›´ãªã©)
CMD mkdir ~/.ssh && \
    mv ~/authorized_keys ~/.ssh/authorized_keys && \
    chmod 0600 ~/.ssh/authorized_keys &&  \
    # æœ€å¾Œã« ssh ã‚’èµ·å‹•
    /usr/sbin/sshd -D
```

## æ‰‹å…ƒã«éµã®ãƒšã‚¢ã‚’ä½œã£ã¦ãŠã

```
$ ssh-keygen -f ./id_rsa -t rsa -b 4096 -C 'example@com' -N ''
```

## ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰


ä¸Šè¨˜ `Dockerfile` ã® `COPY` æŒ‡å®šã«ã‚ˆã‚Šã€å…¬é–‹éµãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã€‚

```
$ docker image build . -t ssh_server
```

## ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ°ã‚‰ã›ã‚‹

```
$ docker run -d -p 10000:22 ssh_server
```

## ç§˜å¯†éµã‚’æŒ‡å®šã—ã¦sshãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹

```
$ ssh root@127.0.0.1 -p 10000 -i id_rsa
```

# ç’°å¢ƒ

- Docker for mac
- Docker version 17.06.1-ce, build 874a737


# ãƒªãƒ³ã‚¯

- [study-docker/ssh/public_key_login_with_copy at master Â· YumaInaura/study-docker](https://github.com/YumaInaura/study-docker/tree/master/ssh/public_key_login_with_copy)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


