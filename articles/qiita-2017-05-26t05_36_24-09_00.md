---
title: "Docker | docker-compose ã®åŸºæœ¬ ( å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚ˆã‚Š )"
emoji: "ğŸ–¥"
type: "idea"
topics: ["åˆå¿ƒè€…", "Docker"]
published: true
---

[Get started with Docker Compose - Docker Documentation](https://docs.docker.com/compose/gettingstarted/#step-1-setup) ã‚ˆã‚Š

# æº–å‚™

ãƒ‡ãƒ¢ç”¨ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹(éå…¬å¼)ã€‚

```bash
$ git clone git@github.com:YumaInaura/study-docker.git

$ cd study-docker/composetest
```

ã‚‚ã—ãã¯ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å…ƒã«ãã‚Œãã‚Œä½œæˆã™ã‚‹ã€‚

## 1. python ã§ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

redis ã§ã‚¢ã‚¯ã‚»ã‚¹å›æ•°ã‚’è¨˜éŒ²ã™ã‚‹ã€‚

```app.py
from flask import Flask
from redis import Redis

app = Flask(__name__)
redis = Redis(host='redis', port=6379)

@app.route('/')
def hello():
    count = redis.incr('hits')
    return 'Hello World! I have been seen {} times.\n'.format(count)

if __name__ == "__main__":
    app.run(host="0.0.0.0", debug=True)
```

## 2. python ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«

```requirements.txt
flask
redis
```

## 3. ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ãŸã‚ã® Dockerfile

```Dockerfile
FROM python:3.4-alpine
ADD . /code
WORKDIR /code
RUN pip install -r requirements.txt
CMD ["python", "app.py"]
```

## 4. ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã¨ Redis ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•æ‰‹é †ã‚’æ›¸ã„ãŸ docker-compose.yml

äºŒã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®è¨˜è¿°ã€‚

```docker-compose.yml
version: '2'
services:
  web:
    build: .
    ports:
     - "5000:5000"
    volumes:
     - .:/code
  redis:
    image: "redis:alpine"
```

# å‹•ä½œã‚’è©¦ã™

## compose ã®å®Ÿè¡Œ

```
$ docker-compose up
```

ã“ã‚Œã ã‘ã§ docker-compose.yml ã«æ›¸ã‹ã‚ŒãŸæ‰‹é †ã§ã‚³ãƒ³ãƒ†ãƒŠãŒä½œæˆã•ã‚Œã‚‹ã€‚

redis ã¨ ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã€ä¸¡æ–¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/89618/14f92641-b494-8420-3cd2-b3d0ea26446a.png)

## ã‚³ãƒ³ãƒ†ãƒŠã®ç¢ºèª

```
$ docker-compose ps
       Name                      Command               State           Ports
-------------------------------------------------------------------------------------
composetest_redis_1   docker-entrypoint.sh redis ...   Up      6379/tcp
composetest_web_1     python app.py                    Up      0.0.0.0:5000->5000/tcp
```

## ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

http://localhost:5000/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/89618/ad496f91-98b2-75a5-c9f5-4df2c373826f.png)

## ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®å‹•ä½œç¢ºèª

docker-compose.yml ã«æ›¸ã„ãŸ `volumes:` ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã¨ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ã§ã€æ‰‹å…ƒã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥è¿½åŠ ã—ãŸã‚Šã€å‰Šé™¤ã—ãŸã‚Šå‡ºæ¥ã‚‹ã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã¨

```
echo 'Hello docker compose!' > hello.txt
```

ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã«ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ã¦ã„ã‚‹ã€‚

```
$ docker exec composetest_web_1 cat hello.txt
Hello docker compose!
```

æ¶ˆã™ã“ã¨ã‚‚å‡ºæ¥ã‚‹

```
$ rm hello.txt
```

```
$ docker exec composetest_web_1 cat hello.txt
cat: can't open 'hello.txt': No such file or directory
```

## ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰ãˆã¦ã¿ã‚‹

ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ã§ã€æ‰‹å…ƒã®ã‚¨ãƒ‡ã‚£ã‚¿ã‚‚ä½¿ãˆã‚‹ã€‚


![image.png](https://qiita-image-store.s3.amazonaws.com/0/89618/59b41e7e-693d-7104-9b60-3a46649e2d7c.png)

### å¤‰æ›´

è©¦ã—ã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤§æ–‡å­—ã«å¤‰ãˆã¦ã¿ã‚‹ã¨

```diff:app.py
- return 'Hello world! I have been seen {} times.\n'.format(count)
+ return 'HELLO WORLD! I have been seen {} times.\n'.format(count)
```

### ç¢ºèª

http://localhost:5000/ ã§ã‚‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/89618/142de85a-f665-67c4-4800-0ad5c172cacf.png)

## ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ã™ã‚‹

```
$ docker-compose down
```

ã§ã‚µãƒ¼ãƒ“ã‚¹ã®åœæ­¢(å„ã‚³ãƒ³ãƒ†ãƒŠã®çµ‚äº†)ãŒå‡ºæ¥ã‚‹ã€‚

# ç’°å¢ƒ

- Docker version 17.03.1-ce, build c6d412e








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


