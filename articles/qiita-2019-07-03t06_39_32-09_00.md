---
title: "#Rails åˆå¿ƒè€…å‘ã‘ - ActiveRecord ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨Rubyãƒ¡ã‚½ãƒƒãƒ‰ã®é•ã„ã‚’æ„è­˜ã—ã¦ã¿ã‚‹"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Rails"]
published: true
published_at: 2019-07-03
---

# é¡Œæ: left_joins ã¨ã‹ã—ã¦é‡è¤‡ã—ãŸçµæœã‚’ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ã™ã‚‹ã«ã¯ uniq ã˜ã‚ƒãªãã¦ distinct ãŒè‰¯ã„ã‚ˆï¼

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ10äººã„ã‚‹ã¨ã

```rb
User.count
# => 10
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã‚Œãã‚Œæœ¬ã‚’ä½•å†Šã‚‚æŒã£ã¦ã‚‹ã¨ã€çµæœãŒå¢—ãˆã‚‹ã‚ˆã­ï¼

```rb
User.left_joins(:books).size
# => 30
```

çµæœã‚’ uniq ã—ãŸã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ãªã‚‹ã‘ã©ï¼Ÿ

```rb
User.left_joins(:books).uniq.size
# => 10
```

ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€”åˆ‡ã‚Œã¦ã—ã¾ã†ã®ã§ã€ãã®å¾Œã« ActiveRecord é–¢ä¿‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç¹‹ã’ã‚‰ã‚Œãªããªã‚‹ã‚ˆï¼

```rb
User.left_joins(:books).uniq.where(id: 1)
# NoMethodError: undefined method `where'
```

Kaminari gem ã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã¨ãã¨ã‹ã«å›°ã‚‹ã‚ˆã­ï¼Ÿ

```rb
User.left_joins(:books).uniq.page(1)
# NoMethodError: undefined method `page'
```

ã§ã‚‚ distinct ãªã‚‰å•é¡Œãªã„ã­ï¼

```rb
User.left_joins(:books).distinct.size
# => 10

User.left_joins(:books).distinct.where(id: 1)

User.left_joins(:books).distinct.page(1)
```

ã“ã®å ´åˆã® distinct ã¯ uniq ã¨çµæœè‡ªä½“ã¯åŒã˜ã ã‚ˆ

åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®é…åˆ—ãŒè¿”ã£ã¦ãã¦ã„ã‚‹ã‚ˆ

```rb
User.left_joins(:books).distinct == User.left_joins(:books).uniq
# true
```

distinct ã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã¯ SQL ã‚’è¦‹ã¦ã¿ã‚ˆã†ï¼

```rb
User.left_joins(:books).to_sql
# => "SELECT `users`.* FROM `users` LEFT OUTER JOIN `books` ON `books`.`user_id` = `users`.`id`"

User.left_joins(:books).distinct.to_sql
# => "SELECT DISTINCT `users`.* FROM `users` LEFT OUTER JOIN `books` ON `books`.`user_id` = `users`.`id`"
```

uniq ã¯ Ruby ã®ãƒ¡ã‚½ãƒƒãƒ‰ãªã®ã§ã€ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³å…ˆã® to_sql ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãªã„ã‚ˆã€‚


```rb
User.left_joins(:books).uniq.to_sql
# NoMethodError: undefined method `to_sql' for #<Array:0x000055b59ea9cbb8>

User.left_joins(:books).uniq.class
# Array
```

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2235








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-07-03
