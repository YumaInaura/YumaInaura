---
title: "#Rails ã® controller ã§å‡¦ç†ã®å¤šé‡é€ä¿¡ã‚’é˜²ããŸã‚ã«ã€model ã« å‡¦ç†ã®idå˜ä½ã®å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ã€transac"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Rails"]
published: true
published_at: 2019-12-23t12:05
---

å‡¦ç†ä¸€å€‹ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª proceeding_id ã‚’æŒã¤ã‚‚ã®ã¨ã™ã‚‹
é‡è¤‡å‡¦ç†ãŒèµ·ã“ã£ãŸå ´åˆã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒINSERTã§ããšã«bad request ã‚’è¿”ã™
å‡¦ç†æœ¬ä½“ãŒå¤±æ•—ã—ãŸå ´åˆã¯rollbackã•ã‚Œã¦å†åº¦å‡¦ç†å¯èƒ½çŠ¶æ…‹ã¨ãªã‚‹

```rb
class SomeController
  def create
    ProceedingHistory.transaction do
      begin
        ProceedingHistory.create(proceeding_id: proceeding_id)
      rescue ActiveRecord::RecordNotUnique
        head :bad_request
        return
      end

      do_something
    end

    head :ok
  end
end

```

```rb
# == Schema Information
#
# Table name: proceeding_histories
#
#  id              :bigint           not null, primary key
#  created_at      :datetime
#  proceeding_history_id :string(255)
#
# Indexes
#
#  index_proceeding_histories_on_proceeding_history_id  (proceeding_history_id) UNIQUE
#

class ProceedingHistory < ApplicationRecord
end

```

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2864








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-12-23
