---
title: "#GCP ( Google Cloud Platform ) ã® Googleç¿»è¨³API ã§ #MarkDown ã‚’ç¿»è¨³ã™ã‚‹ã¨ã‚¹ã‚¿ã‚¤ãƒ«ãŒå´©ã‚Œ"
emoji: "ğŸ–¥"
type: "idea"
topics: ["Ruby", "HTML", "Markdown", "shell", "googlecloud"]
published: true
---


# Prepare

- `sudo gem install reverse_markdown`
- `sudo gem install redcarpet`
- install gcloud
- setting Google Translate API on GCP

# tmp/example.md

<pre>
```
# ã‚ã¾ãŒã¿ãƒ˜ãƒƒãƒ€ãƒ¼

*ãã†ã äº¬éƒ½è¡Œã‹ãªã„ã€‚*

## ã†ãšã‚‰ã®åµ

- ç¥é¢¨ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹
- ãŠãŠã‚€ã­å¤§ä¸ˆå¤«ã§ã™

```
print('å­«æ°ã‚„è€å¸«ã®æ¥½åœ’')
print('ä¸€å¯¸å…ˆã¯ãƒ›ã‚¿ãƒ†')
```
</pre>

# ~/.secret/google-service-credential.json

your GCP service account file json

# get-token.sh

```
GOOGLE_APPLICATION_CREDENTIALS=~/.secret/google-service-credential.json gcloud auth
```

# translate.sh

```
#!/usr/bin/env bash

basedir=$(dirname "$0")

TOKEN=$("$basedir"/get-token.sh) \
  "$basedir"/translate.py | \
  jq --raw-output '.data.translations[].translatedText'
```

# translate.py

Google Translate API ã§ã¯ resouce ã¨ã—ã¦ html å½¢å¼ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã“ã¡ã‚‰)

[Method: translate Â |Â  Cloud Translation API Â |Â  Google Cloud](https://cloud.google.com/translate/docs/reference/rest/v2/translate)

```py
#!/usr/bin/env python3

# -*- coding: utf-8 -*-

import os, sys, requests, json, fileinput, re

#resource_message = ''
#for text in sys.stdin.readlines():
#  resource_message += re.sub(r'\\n', "\n", text)

resource_message = sys.stdin.read()

from_language = os.environ.get('FROM') if os.environ.get('FROM') else 'ja'
to_language = os.environ.get('TO') if os.environ.get('TO') else 'en'
translate_format = os.environ.get('FORMAT') if os.environ.get('FORMAT') else 'text'

data = {
  'q': resource_message,
  'source': from_language,
  'target': to_language,
  'format': translate_format
}

url = 'https://translation.googleapis.com/language/translate/v2'
token = os.environ['TOKEN']

headers = {
 'Authorization': 'Bearer {}'.format(token),
 'Content-Type': 'application/json',
}

res = requests.post(url, headers=headers, json=data)

print(json.dumps(res.json()))
  

```

# exe

- ãƒ†ã‚­ã‚¹ãƒˆã¯ç¿»è¨³ã•ã‚Œã€ã‚³ãƒ¼ãƒ‰ã¯ç¿»è¨³ã•ã‚Œã¦ã„ãªã„ã®ãŒåˆ†ã‹ã‚‹
- PHP / Github ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆè¤‡æ•°å€‹ã§ã® ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜æ³•ãŒã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹4å€‹ã§ã®ãƒ™ãƒ¼ã‚·ãƒƒã‚¯è¨˜æ³•ã«å´©ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ãŒã€è‰¯ã„ ruby gem ã‚„ python module ãªã©ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã¨ã‚Šã‚ãˆãšæ”¾ç½®

```
$ redcarpet --parse=fenced_code_blocks ./tmp/example.md | FORMAT=html ./translate.sh | reverse_markdown
```

ãŸã ã—Googleç¿»è¨³æ™‚ã«ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ”¹è¡ŒãŒå´©ã‚Œã¦ã—ã¾ã†ã‚ˆã†ãªã®ã§ã€ç‹¬è‡ªå¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„

```
# Amagami header 

_Yes I can not go to Kyoto._

## Quail egg 

- Kamikaze Paradise 
- Mostly okay 

     print('å­«æ°ã‚„è€å¸«ã®æ¥½åœ’') print('ä¸€å¯¸å…ˆã¯ãƒ›ã‚¿ãƒ†') 


```

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/1178








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


