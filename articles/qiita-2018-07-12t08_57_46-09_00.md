---
title: "Ansible Playbook ã®åŸºæœ¬ | when / assert ã®æ¡ä»¶æŒ‡å®š è¨˜æ³•ã¾ã¨ã‚"
emoji: "ğŸ–¥"
type: "idea"
topics: ["Ansible"]
published: true
---

# true / false åˆ¤å®š

when ã«å¤‰æ•°ã‚’æ¸¡ã›ã° true / false ã®åˆ¤å®šãŒå‡ºæ¥ã‚‹ã€‚

- `when: some_variable`
- `when: not some_variable`


Booleanä»¥å¤–ãŒå…¥ã£ãŸå¤‰æ•°ã‚‚åˆ¤å®šæ¡ä»¶ã¨ã—ã¦ä½¿ãˆã‚‹ã€‚
ãŸã¨ãˆã°æ–‡å­—åˆ—ã®å ´åˆã¯ã€å€¤ãŒå­˜åœ¨ã™ã‚Œã° `true` ã¨ã€ç©ºã§ã‚ã‚Œã° `false` ã¨ã—ã¦è©•ä¾¡ã•ã‚Œã‚‹æ§˜å­ã€‚

# is defined

å¤‰æ•°ãŒå®šç¾©æ¸ˆã¿ã‹ã©ã†ã‹ã‚’åˆ¤å®šã§ãã‚‹ã€‚

- `when: some_variable is defined`
- `when: some_variable is not defined`



# is succeeded / is failed / is changed / is skipped

å¤‰æ•°ãŒè¾æ›¸ (ãƒãƒƒã‚·ãƒ¥) ã®å ´åˆã¯ã€ä»¥ä¸‹ã®ç‰¹æ®Šæ–‡æ³•ãŒä½¿ãˆã‚‹ã€‚

- `when: dictionary is succeeded`
- `when: dictionary is failed`
- `when: dictionary is changed`
- `when: dictionary is skipped`

ãã‚Œãã‚Œ

- `dictionary.failed`
- `dictionary.change`
- `dictionary.skipped`

ã®å€¤ã® `true / false` ã‚’åˆ¤å®šã™ã‚‹ã€‚

( `is succeeded` ã¯ `dictionary.failed` ã®å€¤ã‚’è¦‹ã¦ãŠã‚Šã€ failed ãŒ false ã ã£ãŸã‚Šã€ ãã‚‚ãã‚‚ failed ã‚­ãƒ¼ãªã„å ´åˆã«ã‚‚ãƒãƒƒãƒã™ã‚‹æ¨¡æ§˜ )

# in

- æ–‡å­—åˆ—ã®ä¸­ã«æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨
- é…åˆ—ã®ä¸­ã«è¦ç´ ãŒã‚ã‚‹ã“ã¨

ãªã©ã‚’æ¤œè¨¼ã§ãã‚‹ã€‚

- `when: "'somebody' in 'Everybody here is somebody'"`
- `when: "'banana' in fruits"`

# è¤‡åˆæ¡ä»¶

when ã«è¤‡æ•°ã®æ¡ä»¶ã‚’é…åˆ—ã§æ¸¡ã™ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚
ã“ã®å ´åˆã€ANDæ¡ä»¶ã§ã²ã¨ã¤ãšã¤è©•ä¾¡ã•ã‚Œã‚‹ã€‚

```yaml
when:
  - some_not_defined_variable is defined
  - some_not_defined_variable # è©•ä¾¡ã•ã‚Œãªã„
```

ã“ã®ä¾‹ã®å ´åˆã ã¨ã€ä¸€å€‹ç›®ã®åˆ¤å®šã§ãã‚Œä»¥é™ã®è©•ä¾¡ã‚’è«¦ã‚ã‚‹ã®ã§ã€äºŒå€‹ç›®ã¯è©•ä¾¡ã•ã‚Œãªã„ã€‚

`and` ã‚„ `or` ã§æ¡ä»¶ã‚’ã¤ãªã’ã¦ã€ã²ã¨ã¤ã® when ã« è¤‡æ•°æ¡ä»¶ã‚’æ¸¡ã™ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã€‚

```yaml
when: some_not_defined_variable is defined and some_not_defined_variable
```

# Playbookã®ä¾‹

```yaml
- hosts: localhost
  tasks:
    - set_fact:
        alice:
          name: Alice
          job: not engineer
          age: 98
          evil_mind: # empty string 
          changed: true
          skipped: true
          failed: false
          kicked: true

    # present string evaluate as true
    - debug:
        msg: "Alice's name is {{ alice.name }}"
      when:
        - alice.name

    # not present string evaluate as false
    - debug:
        msg: "Alice is not evil"
      when:
        - not alice.evil_mind

    # You can use "is succeeded" conditional syntax
    # when alice dictionary has "failed" key and false value then evaluated as succeeded
    - debug:
        msg: "Alice has succeeded as not enginner"
      when:
        - alice is succeeded

    - debug:
        msg: "Alice is not evil"
      when:
        - not alice.evil_mind

    # You can use "is changed" conditional syntax
    # because alice dictionary has "changed" key and boolean value
    - debug:
        msg: "Alice was changed"
      when:
        - alice is changed

    # You can use "is failed" conditional syntax
    # because alice dictionary has "failed" key and false value
    - debug:
        msg: "Alice was not failed to swimming"
      when:
        - alice is not failed

    # You can use "is skipped" conditional syntax
    # because alice dictionary has "skipped" key and true value
    - debug:
        msg: "Alice skipped school programs when she was a child."
      when:
        - alice is skipped

    # You can not use some new original conditional syntax
    #  The conditional check 'alice is kicked' failed. The error was: template error while templating string: no test named 'kicked'
    # - debug:
    #    msg: "Alice has kicked from chat room"
    #  when:
    #    - alice is kicked

    - name: This task will be skipped because alice has no not_found key in he dictionary
      debug:
        msg: "Can you see unknown information of Alice?"
      when:
        - alice.not_found is defined

    - set_fact:
        bob:
          failed: true

    - debug:
        msg: "{{ bob }}"

    - name: 'This task will be skipped because bob has failed key value on his dictionary'
      debug:
        msg: "Bob is succeeded even he does not say anything."
      when:
        - bob is succeeded

    - name: 'This task will be skipped because bob has not changed key on his dictionary'
      debug:
        msg: "Bob is succeeded even he does not say anything."
      when:
        - bob is change

    - set_fact:
        carol:
          name: carol

    - debug:
        msg: Carol is succeeded because she has no failed in her dictionary
      when:
        - carol is succeeded
        - carol is not failed
```

# ç’°å¢ƒ

- ansible 2.6.0









<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


