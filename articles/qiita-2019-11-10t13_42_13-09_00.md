---
title: headless Chrome ã§ HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ PDFå¤‰æ›ã—ãŸã„ã‘ã© ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚’ã—ãŸããªã„ã®ã§ #node ã® html-
emoji: "ğŸ–¥"
type: "idea"
topics: ["Node.js"]
published: true
---

# å®Ÿè¡Œç’°å¢ƒ

AWS ElasticBeanStalk ã® nodejs ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç’°å¢ƒã§ãƒˆãƒ©ã‚¤ã—ãŸã€‚

```
$ cat os-release
NAME="Amazon Linux AMI"
VERSION="2018.03"
ID="amzn"
ID_LIKE="rhel fedora"
VERSION_ID="2018.03"
PRETTY_NAME="Amazon Linux AMI 2018.03"
ANSI_COLOR="0;33"
CPE_NAME="cpe:/o:amazon:linux:2018.03:ga"
HOME_URL="http://aws.amazon.com/amazon-linux-ami/"

$ cat system-release
Amazon Linux AMI release 2018.03
```

dockerã‚’ä½¿ã†å ´åˆã¯ã“ã¡ã‚‰ã‚’å‚ç…§

[Dockerã‚’ä½¿ã£ã¦Headless Chromeã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ - Qiita](https://qiita.com/dd511805/items/dfe03c5486bf1421875a)

# html-pdf-chrome

- HTMLã‚½ãƒ¼ã‚¹ã‚’æ¸¡ã™ã¨PDFå¤‰æ›ã—ã¦ãã‚Œã‚‹nodeã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚‹ã€‚
- ã„ã¡ã©HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãŠãå¿…è¦ãŒãªã„ã®ã§ãŠæ‰‹è»½ã€‚å†…éƒ¨çš„ã«ã¯ã„ã£ãŸã‚“ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚’ã—ã¦ã„ã‚‹ã®ã ã‚ã†ã‘ã‚Œã©ã€ãŸã¶ã‚“ã€‚
- äº‹å‰æº–å‚™ã¨ã—ã¦ã€å½“ãŸã‚Šå‰ã ãŒChromeã®ãƒã‚¤ãƒŠãƒªãŒå¿…è¦ã ã£ãŸã‚Šã€ä¸­é–“å½¹ã¨ãªã‚‹pm2ãŒå¿…è¦ã ã£ãŸã‚Šã™ã‚‹ã€‚

[html-pdf-chrome - npm](https://www.npmjs.com/package/html-pdf-chrome)

# nodejsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Centos ã‚„ AWS Linux ã®å ´åˆ

```
curl -sL https://rpm.nodesource.com/setup_10.x | sudo bash -
sudo yum install -y nodejs
```

# Chrome ãƒã‚¤ãƒŠãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã®ãŒæ‰‹è»½

```
curl https://intoli.com/install-google-chrome.sh | bash
```

# pm2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•


>PM2ã¯ã€Node.js ã‚’æœ¬ç•ªç’°å¢ƒã§èµ·å‹•ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–ã—ãŸã‚Šã®èµ·å‹•ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
https://ajike.github.io/pm2-nodejs/

```
sudo npm install -g pm2
```

- headless Chrome ã¯ã‚ãã¾ã§ãƒ–ãƒ©ã‚¦ã‚¶ãªã®ã§ã€PDFå¤‰æ›ã™ã‚‹ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªURLãŒå¿…è¦ãªãŸã‚ã€pm2ã‚’ä¸­é–“å½¹ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã¨ç†è§£ã—ãŸ
- ã¦ãã¨ã†ãªportã‚’æŒ‡å®šã—ã¦pm2ã‚’èµ·å‹•ã™ã‚‹

```
pm2 start google-chrome-stable \
  --interpreter none \
  -- \
  --headless \
  --disable-gpu \
  --disable-translate \
  --disable-extensions \
  --disable-background-networking \
  --safebrowsing-disable-auto-update \
  --disable-sync \
  --metrics-recording-only \
  --disable-default-apps \
  --no-first-run \
  --mute-audio \
  --hide-scrollbars \
  --remote-debugging-port=9222
```

```
pm2 start google-chrome-stable   --interpreter none   --   --headless   --disable-gpu   --disable-translate   --disable-extensions   --disable-background-networking   --safebrowsing-disable-auto-update   --disable-sync   --metrics-recording-only   --disable-default-apps   --no-first-run   --mute-audio   --hide-scrollbars   --remote-debugging-port=9222
[PM2] Applying action restartProcessId on app [google-chrome-stable](ids: 0)
[PM2] [google-chrome-stable](0) âœ“
[PM2] Process successfully started
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name                    â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status   â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ google-chrome-stable    â”‚ N/A     â”‚ fork    â”‚ 7621     â”‚ 0s     â”‚ 2    â”‚ online   â”‚ 0%       â”‚ 7.5mb    â”‚ ec2-user â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


# node ã§å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

- pm2ã§Chromeã‚’èµ·å‹•ã•ã›ãŸ port ã‚’æŒ‡å®šã™ã‚‹

```

# convert.js

const htmlPdf = require('html-pdf-chrome');
 
const html = `
<p>
Hello, world!
</p>`
;

const options = {
  port: 9222, // port Chrome is listening on
};
 
htmlPdf.create(html, options).then((pdf) => pdf.toFile('test.pdf'));
htmlPdf.create(html, options).then((pdf) => pdf.toBase64());
htmlPdf.create(html, options).then((pdf) => pdf.toBuffer());
```


```
node convert.js
```

# ã‚µã‚¤ã‚ºæŒ‡å®š

CSS ã§æŒ‡å®šã™ã‚Œã°è‰¯ã•ã’
options ã§ã®æŒ‡å®šæ–¹æ³•ã¯åˆ†ã‹ã‚‰ãªã‹ã£ãŸ ( window-size PageWidth ãªã©ã‚’æŒ‡å®šã—ã¦ã¿ãŸã‚‚ã®ã® )

```
<style>
@page {
  margin: 0;
  padding: 0;
  size: 15in 11in;
}
</style>
```

# PDFã‚’ç¢ºèªã™ã‚‹

ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰localeã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ç¢ºèª

```
 scp -i /Users/yumainaura/.ssh/pup.pem ec2-user@XXX.XXX.XXX.XXX:/home/ec2-user/test.pdf ~/tmp
 open ~/tmp/test.pdf
```


![image](https://user-images.githubusercontent.com/13635059/68537291-7921ce80-03a4-11ea-954b-8b5fadc20490.png)




# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2700








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


