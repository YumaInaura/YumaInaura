---
title: "#Rails + #rspec ã§ rake ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’æ¯å›å¿˜ã‚Œã‚‹ã®ã§æ›¸ãç•™ã‚ã¦ãŠã ( LoadError: Can't find "
emoji: "ğŸ–¥"
type: "tech"
topics: ["Rails", "RSpec"]
published: true
published_at: 2019-11-25
---

# ã¾ã¨ã‚

- å…¬å¼ãªã‚„ã‚Šæ–¹ã§ã¯ãªãã€ã‚ãã¾ã§å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ã‚‰ã‚’Hackã—ã¦åˆ©ç”¨ã™ã‚‹ã‚„ã‚Šæ–¹ã£ã½ã„ã®ã§ç…©é›‘ã§ä½¿ã„ã«ãã„ã“ã¨ã¯å¿ƒãˆã‚‹
- rake_require ã§å…ƒã®rake fileã•ãˆloadã§ããŸã‚‰å‹ã¡
- rake_require ã§ã¯ã‚¿ã‚¹ã‚¯åã§ã‚‚éšå±¤ã§ã‚‚ãªãã€å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã‚’ä¸ãˆã¦ã„ã‚‹ã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆ
- ä¸€åº¦rake file ã‚’requireã—ã¦ã—ã¾ãˆã°ã€task invoke ã§ãã‚‹
- ã†ã¾ãrequireã§ããªã„å ´åˆã¯ `Rake.load_rakefile` ãªã©å†…å´ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ã©ã†ã‹ã²ãŸã™ã‚‰ãƒã‚§ãƒƒã‚¯ã›ã‚ˆ

# rake

`/app/lib/tasks/foo/bar.rake`

```rb
namespace :foo do
  task bar: :environment do |task|
    SomeClass.run
  end
end
```

# rspec


```rb
require "rails_helper"
require "rake"

describe do
  before(:all) do
    @rake = Rake::Application.new
    Rake.application = @rake

    # This line require file e.g '/app/lib/tasks/foo/bar.rake'
    Rake.application.rake_require('bar', [Rails.root.join('lib', 'tasks', 'foo')])

    Rake::Task.define_task(:environment)
  end

  before(:each) do
    @rake[task].reenable
  end

  describe  do
    # Do not use dot
    # BAD CASE : foo.bar 
    let(:task) { 'foo:bar' }

    it do
      expect(SomeClass).to receive(:run)
      @rake[task].invoke
    end
  end
end
```

# Doc


https://apidock.com/ruby/v1_9_3_392/Rake/Application/rake_require

>File lib/rake/application.rb, line 452

```rb
def rake_require(file_name, paths=$LOAD_PATH, loaded=$")
  fn = file_name + ".rake"
  return false if loaded.include?(fn)
  paths.each do |path|
    full_path = File.join(path, fn)
    if File.exist?(full_path)
      Rake.load_rakefile(full_path)
      loaded << fn
      return true
    end
  end
  fail LoadError, "Can't find #{file_name}"
end
```

# Ref

[Rspecã§rake taskã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã€€ - Qiita](https://qiita.com/geshi/items/4ea8e88a4e82c0934371)
[Rakeã‚¿ã‚¹ã‚¯ã®ãƒ†ã‚¹ãƒˆã®ä»•æ–¹ - Qiita](https://qiita.com/kawakubox/items/26cf71a14bd5827175f6)
[[Ruby on Rails]RSpecã«ã‚ˆã‚‹Rakeã®ãƒ†ã‚¹ãƒˆ ï½œ Developers.IO](https://dev.classmethod.jp/server-side/ruby-on-rails/ruby-on-rails_rspec_rake_test/)

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2767








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-11-25
