---
title: "#Rails ã® preload ã§ã¯é–¢é€£å…ˆãƒ†ãƒ¼ãƒ–ãƒ«ã®çµã‚Šè¾¼ã¿ã¯ã§ããšã€eager_loadã§ã¯å¯èƒ½ ( joins / includes "
emoji: "ğŸ–¥"
type: "idea"
topics: ["Rails"]
published: true
---

```rb
# preload ã§ã¯ è‡ªåˆ†ã‹ã‚‰ã®æ¤œç´¢ã¯å¯èƒ½
users = User.where(id: [1,2,3,4,5]).preload(:books)

# preload ã§ã¯ é–¢é€£å…ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã®æ¤œç´¢ã¯ä¸å¯èƒ½
users = User.preload(:books).where(books: { name: "Alice Wonder Land" }).first
# ActiveRecord::StatementInvalid: Mysql2::Error: Unknown column ...


# preload  + joins ã§é–¢é€£å…ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã®æ¤œç´¢ãŒå¯èƒ½ã ãŒã€ join ã®ä½œç”¨ã§ é–¢é€£å…ˆãƒ†ãƒ¼ãƒ–ãƒ«ã®æ•°ã ã‘è¿”ã£ã¦ãã‚‹çµæœæ•°ã‚‚å¤šããªã‚‹
# åŒã˜Userã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå¤§é‡ã«è¿”ã£ã¦ããŸã‚Š
# merge ã§ã‚‚ where ã§ã‚‚æ›¸ã‘ã‚‹ãŒã€ã©ã¡ã‚‰ã§ã‚‚æŒ™å‹•ã¯å¤‰ã‚ã‚‰ãªã„ã£ã½ã„ï¼Ÿ
users = User.joins(:books).preload(:books).where(books: { name: "Alice Wonder Land" })
users = User.joins(:books).preload(:books).merge(Book.where(name: "Alice Wonder Land" ))

# preload  + joins 
# uniq ã™ã‚Œã° User ã‚‚ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ãªã‚‹ãŒã€ãªã‚“ã ã‹ç„¡ç†ã‚„ã‚Šãªæ°—ã‚‚ã™ã‚‹
users = User.joins(:books).preload(:books).merge(Book.where(name: "Alice Wonder Land" )).uniq

# eager_load ã§ã¯é–¢é€£å…ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚‚æ¤œç´¢ã‚‚å¯èƒ½
users = User.eager_load(:books).where(books: { name: "Alice Wonder Land" })


# includes ã¯ preload ã¨ eager_load ã®ã©ã¡ã‚‰ã‹ã‚’è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆã¦ãã‚Œã‚‹ã®ã§ã€é–¢é€£å…ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æ¤œç´¢ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€eager_load ã¨åŒã˜ã‚¯ã‚¨ãƒªã€åŒã˜æŒ™å‹•ã«ãªã‚‹
users = User.includes(:books).where(books: { name: "Alice Wonder Land" })

```

# ãƒ’ãƒ³ãƒˆ

`.to_sql` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¯ã‚¨ãƒªã®ä¸­èº«ã‚’è¦‹ã¦ã¿ãŸã‚Šã€ãã®SQLã‚’ç›´æ¥ DB ã«ç™ºè¡Œã—ã¦ã€è¿”ã£ã¦ãã‚‹DBã®çµæœã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚

# å‚è€ƒ

[ActiveRecord ï½ è¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¾ãŸãŒã‚‹æ¤œç´¢ï¼ˆpreload, eager_load, include, joinsï¼‰ - Qiita](https://qiita.com/leon-joel/items/f26556c9e56833983856)

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/3062








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


