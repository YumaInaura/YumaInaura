---
title: "AWS CodePipeline - aws ecr get-login-password ... docker login ãŒå¤±æ•—ã™ã‚‹ ("
emoji: "ğŸ–¥"
type: "idea"
topics: ["AWS", "Docker", "CodePipeline"]
published: true
---

# buildspec.yml

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é€šã‚Šã®ã ã„ãŸã„ã“ã‚“ãªã‚„ã¤

```yaml
version: 0.2

phases:
  pre_build:
    commands:
      - echo Logging in to Amazon ECR...
      - aws --version
      - aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin 012345678910.dkr.ecr.us-west-2.amazonaws.com
      - REPOSITORY_URI=012345678910.dkr.ecr.us-west-2.amazonaws.com/hello-world
      - COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
      - IMAGE_TAG=${COMMIT_HASH:=latest}
  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image...
      - docker build -t $REPOSITORY_URI:latest .
      - docker tag $REPOSITORY_URI:latest $REPOSITORY_URI:$IMAGE_TAG
  post_build:
    commands:
      - echo Build completed on `date`
      - echo Pushing the Docker images...
      - docker push $REPOSITORY_URI:latest
      - docker push $REPOSITORY_URI:$IMAGE_TAG
      - echo Writing image definitions file...
      - printf '[{"name":"hello-world","imageUri":"%s"}]' $REPOSITORY_URI:$IMAGE_TAG > imagedefinitions.json
artifacts:
    files: imagedefinitions.json
```

# ã‚¨ãƒ©ãƒ¼ä¾‹

```
[Container] 2023/02/08 09:45:48 Phase context status code: COMMAND_EXECUTION_ERROR Message: Error while executing command: aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin *********.dkr.ecr.ap-northeast-1.amazonaws.com. Reason: exit status 1
```

# è§£æ±º

ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ > ãƒ“ãƒ«ãƒ‰ã®è©³ç´° > ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«

ã®ãƒªãƒ³ã‚¯ã‹ã‚‰IAMã§ãƒãƒªã‚·ãƒ¼ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ãŸ
( *EC2InstanceProfileForImageBuilderECRContainerBuilds* ã‚’è¿½åŠ  )

![image](https://user-images.githubusercontent.com/13635059/217496514-6ecbc0eb-060d-4c12-bf3b-384bf04ef405.png)

![image](https://user-images.githubusercontent.com/13635059/217496520-815bde40-ce50-4f23-a189-62407a55cae5.png)

![image](https://user-images.githubusercontent.com/13635059/217496522-3e241e3a-ec60-42a2-99f6-05b5d6f4039d.png)


# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ


# Twitter

https://twitter.com/YumaInaura

