---
title: "Docker åˆå¿ƒè€… |  python ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ | å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« part2 ã‚ˆã‚Š"
emoji: "ğŸ–¥"
type: "tech"
topics: ["åˆå¿ƒè€…", "Docker"]
published: true
---

# Dockerfileã‚’ä½œæˆ

ãƒ­ãƒ¼ã‚«ãƒ«ã®é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Dockerfile ã‚’ä½œã‚‹ã€‚

```bash:Dockerfile
# ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æŒ‡å®š
# è‡ªå‹•çš„ã« docker hub ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã‚‹
FROM python:2.7-slim

# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š
WORKDIR /app

# ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­èº«ã‚’å…¨ã¦ ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã™ã‚‹
# ã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œæ™‚ã§ã¯ãªãã€ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹
ADD . /app

# python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®å‡¦ç†
RUN pip install -r requirements.txt

EXPOSE 80

# ç’°å¢ƒå¤‰æ•°ã®æŒ‡å®š
# Docker ã‚³ãƒ³ãƒ†ãƒŠã§ export NAME=World ã—ãŸçŠ¶æ…‹ã«ãªã‚‹
ENV NAME World

# ã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œæ™‚ã«èµ°ã‚‰ã›ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®æŒ‡å®š
# ã“ã®ä¾‹ã§ã¯ $ python app.py ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãŒèµ°ã‚‹
CMD ["python", "app.py"]
```

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã‚‹ã€‚

```py:app.py
from flask import Flask
from redis import Redis, RedisError
import os
import socket

# Connect to Redis
redis = Redis(host="redis", db=0, socket_connect_timeout=2, socket_timeout=2)

app = Flask(__name__)

@app.route("/")
def hello():
    try:
        visits = redis.incr('counter')
    except RedisError:
        visits = "<i>cannot connect to Redis, counter disabled</i>"

    html = "<h3>Hello {name}!</h3>" \
           "<b>Hostname:</b> {hostname}<br/>" \
           "<b>Visits:</b> {visits}"
    return html.format(name=os.getenv('NAME', "world"), hostname=socket.gethostname(), visits=visits)

if __name__ == "__main__":
	app.run(host='0.0.0.0', port=80)
```

```text:requirements.txt
Flask
Redis
```

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ

Dockerfile ã‚’å…ƒã«ã€åå‰ä»˜ãã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ã€‚

```
docker build -t python-server .
```

```
$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
python-server       latest              c3907742b08f        7 seconds ago       195 MB
```

# ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ

ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ°ã‚‰ã›ã‚‹ã€‚

ã“ã®ä¾‹ã§ã¯ dockerä¸Šã®80ç•ªã‚’ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®4000ç•ªã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

```
docker run -p 4000:80 python-server
```

## ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹

http://localhost:4000/ ãŒè¡¨ç¤ºã§ããŸã‚‰æˆåŠŸã ã€‚

![image](https://qiita-image-store.s3.amazonaws.com/0/89618/0ab1872b-1fd9-16b8-c5d1-5453769328c8.png)

(æ‰‹å…ƒã§ã¯ãªãœã‹redisãŒå‹•ã„ã¦ã„ãªã‹ã£ãŸâ€¦ã‚ã¨ã§èª¿ã¹ã‚‹)

# dockerã‚µãƒ¼ãƒãƒ¼ã«å…¥ã‚‹

ã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œä¸­ã§ã‚ã‚Œã°ã€dockerã‚µãƒ¼ãƒãƒ¼ã«ç›´æ¥å…¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

## ãƒ—ãƒ­ã‚»ã‚¹IDã®ç¢ºèª

```
$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS                  NAMES
c7b95a8a2a22        python-server       "python app.py"     About a minute ago   Up About a minute   0.0.0.0:4000->80/tcp   examole-server
```

## exec

ã‚³ãƒ³ãƒ†ãƒŠIDã‚’æŒ‡å®šã—ã¦ `docker exec` ã™ã‚‹ã€‚

ä¾‹:

```
docker exec -it c7b95a8a2a22 /bin/bash
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå±•é–‹ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã€‚

```bash
$ ls
Dockerfile  app.py  requirements.txt
```

## ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

Dockerfileã«è¨˜è¿°ã—ãŸç’°å¢ƒå¤‰æ•°ãŒ export ã•ã‚Œã¦ã„ã‚‹ã€‚

```bash
$ echo $NAME
World
```

# å‚è€ƒ

- [Get Started, Part 2: Containers - Docker Documentation](https://docs.docker.com/get-started/part2/)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


