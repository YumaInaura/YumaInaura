---
title: #Stripe + ngrok ã§ localç’°å¢ƒã§ webhook ç™ºè¡Œ / webhookå†é€ä¿¡ã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹
emoji: "ğŸ–¥"
type: "idea"
topics: ["stripe"]
published: true
---

# å•é¡Œ

stripe cli ã§ã‚‚ webhook ã® local ã§ã®ãƒ†ã‚¹ãƒˆãŒã§ãã‚‹ãŒã€ã“ã¡ã‚‰ã¯ã‚ãã¾ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ä»•æ§˜ãªã®ã§ã€ä¸€åº¦ç™ºç”Ÿæ¸ˆã¿ã®webhookã‚’å†é€ã™ã‚‹å ´åˆã¯ã€localã«ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã“ã¨ãŒã§ããªã„

global ãªURLã‚’ç™ºè¡Œã—ã¦localã«è»¢é€ã—ã¦ãã‚Œã‚‹ngrokã‚’åˆ©ç”¨ã™ã‚‹

# ngrok ã‚’èµ·å‹•ã™ã‚‹

ã“ã®ã‚ˆã†ãªURLãŒç™ºè¡Œã•ã‚Œã‚‹

https://eb3a6a4a.ngrok.io

ã“ã“ã«æ¥ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒlocalã«è»¢é€ã•ã‚Œã‚‹

http://localhost:80

```
ngrok http 80
```

```
ngrok by @inconshreveable                                                                                                      (Ctrl+C to quit)

Session Status                online
Session Expires               7 hours, 59 minutes
Version                       2.3.35
Region                        United States (us)
Web Interface                 http://127.0.0.1:4040
Forwarding                    http://eb3a6a4a.ngrok.io -> http://localhost:80
Forwarding                    https://eb3a6a4a.ngrok.io -> http://localhost:80

Connections                   ttl     opn     rt1     rt5     p50     p90
                              0       0       0.00    0.00    0.00    0.00


```

ngrokã¯èµ·å‹•ã•ã›ãŸã¾ã¾ã«ã—ã¦ãŠã

# Stripe

Stripeã§webhookã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹
ç™ºè¡Œã•ã‚ŒãŸngrokã®URL ã‚’å…¥åŠ›ã™ã‚‹
ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã—ã¦ãŠã

![image](https://user-images.githubusercontent.com/13635059/70756794-e1d3e080-1d80-11ea-987a-c9a900ca8502.png)

# Stripeã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã•ã‚Œã‚‹å‡¦ç†ã‚’ã™ã‚‹

ç›´æ¥Webhooké€ä¿¡ã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹

![image](https://user-images.githubusercontent.com/13635059/70757169-f369b800-1d81-11ea-8302-c576b190089d.png)

ã‚‚ã—ãã¯webhookãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
ä¾‹ãˆã°é¡§å®¢ã‚’ä½œæˆã—ã¦ã¿ã‚‹
äº‹å‰ã«webhookè¨­å®šã§ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨­å®šã—ã¦ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹

![image](https://user-images.githubusercontent.com/13635059/70756851-05972680-1d81-11ea-9d32-4ff8cf8e72c5.png)




# ngrokã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé£›ã‚“ã§ãã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹
http://localhost:80 ã«ã¯ä½•ã‚‚ãªã„ã®ã§ BAD REQEST æ‰±ã„ã«ãªã£ã¦ã„ã‚‹çŠ¶æ…‹


```
HTTP Requests
-------------

POST /                         502 Bad Gateway
```

# node ãªã©ã§ local ã« http ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã•ã›ã¦ã‹ã‚‰ webhook ã‚’è©¦ã™

`node ok.js`

```
var http = require('http');
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello New York\n');
}).listen(80);
console.log('Server running at http://localhost:80/');
```

200 ok ã‚’ç¢ºèªã§ããŸä¾‹

![image](https://user-images.githubusercontent.com/13635059/70757448-f1ecbf80-1d82-11ea-9f7f-2cc8c8050a61.png)

![image](https://user-images.githubusercontent.com/13635059/70757439-e7cac100-1d82-11ea-9f29-d8e90dc2b719.png)


# Webhookå†é€ä¿¡

ã™ã§ã«ç™ºè¡Œæ¸ˆã¿ã®webhookã‚’å†é€ä¿¡ã™ã‚‹å ´åˆã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä¸€æ™‚çš„ã« ngrok ã®ã‚‚ã®ã«æ›¸ãæ›ãˆã¦å†é€ã‚’è©¦ã™ã¨è‰¯ã„ã ã‚ã†ã€‚

![image](https://user-images.githubusercontent.com/13635059/70757127-d03f0880-1d81-11ea-97b3-77da9ee67072.png)


# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2842








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


