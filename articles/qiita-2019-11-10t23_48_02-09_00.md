---
title: "#docker alpine + headless Chrome + #node pm2 + html-pdf-chrome ã§ HTML "
emoji: "ğŸ–¥"
type: "tech"
topics: ["Node.js", "Docker"]
published: true
published_at: 2019-11-10
---

# html-pdf-chrome

https://github.com/westy92/html-pdf-chrome

- puppeteer ã§ã¯ãªã„
- HTMLãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãã‚½ãƒ¼ã‚¹ã‚’æ¸¡ã—ãŸæ™‚ã«PDFå¤‰æ›ã—ãŸã„

# docker

```
docker run -it alpine ash
```

# chromium ãƒ•ã‚©ãƒ³ãƒˆ nodejs ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
apk add --update udev ttf-freefont chromium nodejs npm
```

# å¿…è¦ãŒã‚ã‚Œã° Google æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
mkdir /noto

cd /noto

wget https://noto-website.storage.googleapis.com/pkgs/NotoSansCJKjp-hinted.zip

unzip NotoSansCJKjp-hinted.zip && mkdir -p /usr/share/fonts/noto && cp *.otf /usr/share/fonts/noto && chmod 644 -R /usr/share/fonts/noto/ && fc-cache -fv

cd /
````

[Dockerã‚’ä½¿ã£ã¦Headless Chromeã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ - Qiita](https://qiita.com/dd511805/items/dfe03c5486bf1421875a)

# node module ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm install html-pdf-chrome
npm install -g pm2
```

# pm2ã®èµ·å‹•

--headless --no-sandbox  --disable-gpu ã‚’æŒ‡å®šã™ã‚‹

```
pm2 start chromium-browser --interpreter none -- --headless --no-sandbox  --disable-gpu --disable-translate --disable-extensions --disable-background-networking --safebrowsing-disable-auto-update --disable-sync --metrics-recording-only --disable-default-apps --no-first-run --mute-audio --hide-scrollbars --remote-debugging-port=9222

...

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name                    â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status   â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ chromium-browser        â”‚ N/A     â”‚ fork    â”‚ 99       â”‚ 0s     â”‚ 0    â”‚ online   â”‚ 0%       â”‚ 2.0mb    â”‚ root     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

# å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

CSSã‚‚ã™ã¹ã¦è©°ã‚è¾¼ã‚“ã HTML

```js
const htmlPdf = require('html-pdf-chrome');

const html = `
<html>
<head>
  <style>
  @page {
    margin: 0;
    padding: 0;
    size: 15in 11in;
  }
</style>
</head>
<body>
<h1>HELLO!</h1>
</body>
</html>
`;

const options = {
  port: 9222, // port Chrome is listening on
};

htmlPdf.create(html, options).then((pdf) => pdf.toFile('./example.pdf'));
htmlPdf.create(html, options).then((pdf) => pdf.toBase64());
htmlPdf.create(html, options).then((pdf) => pdf.toBuffer());
```

# å¤‰æ›

```
node convert.js
```

# local ã§ç¢ºèª

```
docker cp <DOCKER_CONTAINER_ID>:/example.pdf ./
open ./example.pdf
```

# çµæœ

![image](https://user-images.githubusercontent.com/13635059/68540543-3c22ff80-03d7-11ea-953f-bcffd0c2d397.png)

# CSS JS å¯¾å¿œçŠ¶æ³ã¯ï¼Ÿ

headless chrome ã‚’åˆ©ç”¨ã—ã¦ã‚‹ã®ã§ã€ãªã‚“ã§ã‚‚ã§ãã‚‹ã§ã—ã‚‡ã€‚

# HTML ã‹ã‚‰ CSS JS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ã«ã¯ï¼Ÿ

docker ã§ http ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¦ å¤–éƒ¨å‚ç…§å¯èƒ½ãªå ´æ‰€ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã‘ã‚Œã°ã‚ˆã„ã®ã‹ã‚‚ã—ã‚Œãªã„ãŒã€æœªèª¿æŸ»ã€‚

pm2 ãŒä½¿ãˆã‚‹ï¼Ÿä½¿ãˆãªã„ï¼Ÿ ä½¿ã„æ–¹èª¿æŸ»ãŒå¿…è¦ã ã€‚

# AWS - Amazon Linux ç’°å¢ƒã®å ´åˆã¯

chrome binary ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã® universal ãª shell script ãŒã‚ã‚‹

[Installing Google Chrome On CentOS, Amazon Linux, or RHEL](https://intoli.com/blog/installing-google-chrome-on-centos/)

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2706








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2019-11-10
