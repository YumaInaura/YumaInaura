---
title: "#Stripe ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ webhook ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã‚’è¿½åŠ ã—ã¦ãƒ†ã‚¹ãƒˆé€ä¿¡ã—ã¦ã¿ã‚‹ ( e.g subscriptio"
emoji: "ğŸ–¥"
type: "idea"
topics: ["stripe"]
published: true
---


https://dashboard.stripe.com/test/webhooks

é–‹ç™ºè€… > Webhook ã‹ã‚‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆ ã« webhook ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«å¯¾ã—ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ã¿ãŸã„ã 
(å½“ãŸã‚Šå‰ã‹ï¼Ÿ)

ä¸€å€‹ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é¸ã¶ã€ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸ã¶ã€è¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é¸ã¶ã“ã¨ãŒã§ãã‚‹

![image](https://user-images.githubusercontent.com/13635059/70361444-eef65880-18c4-11ea-81d7-462a5abdb64d.png)

![image](https://user-images.githubusercontent.com/13635059/70361551-4bf20e80-18c5-11ea-81db-5e615469c967.png)

![image](https://user-images.githubusercontent.com/13635059/70361468-02a1bf00-18c5-11ea-9a77-127dbd905712.png)

# ãƒ†ã‚¹ãƒˆé€ä¿¡

ç°¡å˜ã«ãƒ†ã‚¹ãƒˆé€ä¿¡ãŒã§ãã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèªã§ãã‚‹ã¿ãŸã„ã ã€‚

![image](https://user-images.githubusercontent.com/13635059/70361626-878cd880-18c5-11ea-91e6-0f1553e23dcc.png)
![image](https://user-images.githubusercontent.com/13635059/70361627-88be0580-18c5-11ea-80e4-95d2cd7f31aa.png)

# webhookã®ãƒªã‚¢ãƒ«ãªå‹•ä½œç¢ºèª

ãƒ†ã‚¹ãƒˆé€ä¿¡ã§ã¯ãªãæœ¬å½“ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹å ´åˆ

ä¾‹ãˆã° Subscription å®šæœŸæ”¯æ‰•ã„ã® è«‹æ±‚ã®æ”¯æ‰•ã„æˆåŠŸ invoice.payment_succeeded ã§ã‚ã‚Œã°ã€
å®Ÿéš›ã« Stripe API ã‚„ Stripe CLI ã‚’ä½¿ã£ã¦ ã€Œæ”¯æ‰•ã„æˆåŠŸã€ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ãªå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚Œã°è‰¯ã„

ã™ã‚‹ã¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚‚webhookã®å±¥æ­´ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹


```
customer=$(stripe customers create --email="alice@example.com")
echo "$customer" | jq

customer_id=$(echo "$customer" | jq -r '.id')
echo "$customer_id"

# Create Plan and Product in both time
# https://stripe.com/docs/api/plans/create?lang=curl
# https://stripe.com/docs/billing/subscriptions/products-and-plans
plan=$(stripe plans create --interval='day' --currency='jpy' --amount='1000' --data="product[name]"="Gold special")
echo "$plan" | jq

plan_id=$(echo "$plan" | jq -r .id)

# Create payment method as credit card
# https://stripe.com/docs/api/payment_methods/create
payment_method=$(stripe payment_methods create --type="card" --data "card[number]"=4242424242424242 --data "card[exp_month]"=12 --data "card[exp_year]"=2020 --data "card[cvc]"=314)
echo "$payment_method" | jq
payment_method_id=$(echo "$payment_method" | jq -r .id)

# Attach payment method to customer
# https://stripe.com/docs/api/payment_methods/attach
stripe payment_methods attach "$payment_method_id" --data "customer=$customer_id"

# Set default payment method to customer
# https://stripe.com/docs/api/customers/update#update_customer-invoice_settings-default_payment_method

# Create subscription for customer
# https://stripe.com/docs/api/subscriptions/create
stripe subscriptions create --customer="$customer_id" --default-payment-method="$payment_method_id" --data="items[0][plan]"="$plan_id"

# open https://dashboard.stripe.com/test/customers/"$customer_id"

```

![image](https://user-images.githubusercontent.com/13635059/70361770-0124c680-18c6-11ea-9448-8eeb07e6be43.png)





# webhookã‚’å—ã‘å–ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã ä½œã£ã¦ã„ãªã„å ´åˆ

webhook ã®ãƒ†ã‚¹ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚„ã‚‹ã«ã¯ Stripe CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ãŒè‰¯ã„ã ã‚ã†


ãã¡ã‚‰ã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆé€ä¿¡æ©Ÿèƒ½ã¨ã¯ç¹‹ãŒã£ã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œãªã„ãŒï¼Ÿ

# Original by Github issue

https://github.com/YumaInaura/YumaInaura/issues/2821








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


