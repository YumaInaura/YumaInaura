---
title: git + peco + Vim â€” git grep ã§ãƒãƒƒãƒã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§Vim ã§ç·¨é›†ã™ã‚‹
emoji: "ğŸ–¥"
type: "idea"
topics: ["Vim", "Git", "Peco"]
published: true
---


## ã‚¤ãƒ¡ãƒ¼ã‚¸

- `echo` ã¨ã„ã†æ–‡å­—åˆ—ãŒã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `git grep` ã™ã‚‹
- 12è¡Œç›®ã§ãƒãƒƒãƒã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶

![image](https://user-images.githubusercontent.com/13635059/44803731-40ac2f80-abfa-11e8-9839-85b8365107b7.png)

- Vimã§12è¡Œç›®ã‹ã‚‰ç·¨é›†é–‹å§‹ã§ãã‚‹

![image](https://user-images.githubusercontent.com/13635059/44803733-41dd5c80-abfa-11e8-9cbb-e4328ed012ea.png)

## ãƒã‚¤ãƒ³ãƒˆ

- `$EDITOR` ã®ç’°å¢ƒå¤‰æ•°ã§åˆ©ç”¨ã™ã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã‚’æ±ºã‚ã‚‹
- `git grep --line-number` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã€git grepã§å¼•ã£ã‹ã‹ã£ãŸè¡Œã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã™ã‚‹ ( Vim ã‚’ä½¿ã†å ´åˆ )
- git grep ã®çµæœã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
- peco ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œç´¢ã‚’ã™ã‚‹
  - [peco/peco: Simplistic interactive filtering tool](https://github.com/peco/peco)
  
## ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹

```sh
#!/usr/bin/env bash -eu

# Usage
#
# $ command [grep-keyword] --some-grep-option

# åˆ©ç”¨ã™ã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰æ±ºã‚ã‚‹
readonly editor=${EDITOR:-vim}

# peco ãŒå…¥ã£ã¦ã„ãªã‘ã‚Œã°çµ‚äº†ã™ã‚‹
if [ ! $(which peco) ]; then
  echo You need peco please install
  exit
fi

# git grep ã™ã‚‹
# git grep ã«ã¯è‡ªç”±ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«ã—ã¦ãŠã ( --line-number ã‚’ã®ãã„ã¦ )
readonly git_grep_result=$(git grep --line-number $@)

# git grep ã®ãƒãƒƒãƒçµæœãŒãªã‘ã‚Œã°çµ‚äº†ã™ã‚‹
if [ -z "$git_grep_result" ]; then
  echo No match with git grep
  exit
fi

# git grep ã®çµæœã‹ã‚‰pecoã§æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹
readonly git_grep_select=$(echo "$git_grep_result" | peco --query="$1")

# peco ã§ã®é¸æŠçµæœãŒãªã‘ã‚Œã°çµ‚äº†ã™ã‚‹
if [ -z "$git_grep_select" ]; then
  exit
fi

# pecoã§é¸ã‚“ã è¡Œã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
readonly filepath=$(echo "$git_grep_select" | awk -F':' '{ print $1 }')

# git grep ã®çµæœã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œç•ªå·ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
readonly line_number=$(echo "$git_grep_select" | awk -F':' '{ print $2 }')

if [ ! -z "$filepath" ]; then
  # ã‚¨ãƒ‡ã‚£ã‚¿ãŒ Vim ãªã‚‰ å¼•ã£ã‹ã‹ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«è¡Œç•ªå·ã‹ã‚‰é–‹ãã‚ˆã†ã«ã™ã‚‹
  if [[ "$editor" =~ vim ]] && [ ! -z "$line_number" ]; then
    eval "$editor" +"$line_number" "$filepath"
  else
    eval "$editor" "$filepath"
  fi
fi
```

[gitim/git-grep-edit at acdbbf9bcbfd92e10d62be3f92bff5e6e5b0366e Â· YumaInaura/gitim](https://github.com/YumaInaura/gitim/blob/acdbbf9bcbfd92e10d62be3f92bff5e6e5b0366e/bin/git-grep-edit)

## Versions

- git version 2.8.1
- peco version v0.5.3 (built with go1.10)
- bash 4.2
- Mac OS High Sierra

## Links

- [Gist](https://gist.github.com/YumaInaura/ed6963ad1b0898299628b1291e2e71f4)
- [Mediumâ€”imported](https://medium.com/supersonic-generation/git-git-grep-and-edit-with-editor-e-g-vim-fae7d468530f)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


