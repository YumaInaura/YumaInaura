---
title: "curl ã§ SSL ãŒç¹‹ã’ãªã„  curl: (35) SSL connect error"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Linux", "CentOS", "curl", "SSL", "NSS"]
published: true
published_at: 2018-06-23t16:43
---

## BEFORE

`--verbose` ã™ã‚‹ã¨ã€TLSã®ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã§å¤±æ•—ã—ã¦ã€ SSLv3ã€€ã§ã¤ãªãã«è¡Œã“ã†ã¨ã—ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã€‚

>Error in TLS handshake, trying SSLv3...

```
[root@2f13a8e79be2 /]# curl --verbose https://toolbelt.treasuredata.com/sh/install-ubuntu-xenial-td-agent2.sh
* About to connect() to toolbelt.treasuredata.com port 443 (#0)
*   Trying 151.101.89.177... connected
* Connected to toolbelt.treasuredata.com (151.101.89.177) port 443 (#0)
* Initializing NSS with certpath: sql:/etc/pki/nssdb
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* NSS error -12190
* Error in TLS handshake, trying SSLv3...
> GET /sh/install-ubuntu-xenial-td-agent2.sh HTTP/1.1
> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.15.3 zlib/1.2.3 libidn/1.18 libssh2/1.4.2
> Host: toolbelt.treasuredata.com
> Accept: */*
>
* Connection died, retrying a fresh connect
* Closing connection #0
* Issue another request to this URL: 'https://toolbelt.treasuredata.com/sh/install-ubuntu-xenial-td-agent2.sh'
* About to connect() to toolbelt.treasuredata.com port 443 (#0)
*   Trying 151.101.89.177... connected
* Connected to toolbelt.treasuredata.com (151.101.89.177) port 443 (#0)
* TLS disabled due to previous handshake failure
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* NSS error -12286
* Closing connection #0
* SSL connect error
curl: (35) SSL connect error
```

## nss ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

nss ã‚’ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã¿ã‚‹ã€‚

```
[root@f44f49e49007 /]# yum info nss

Installed Packages
Name        : nss
Arch        : x86_64
Version     : 3.16.1
Release     : 14.el6
Size        : 2.5 M
Repo        : installed
From repo   : CentOS
Summary     : Network Security Services
URL         : http://www.mozilla.org/projects/security/pki/nss/
License     : MPLv2.0
Description : Network Security Services (NSS) is a set of libraries designed to
            : support cross-platform development of security-enabled client and
            : server applications. Applications built with NSS can support SSL v2
            : and v3, TLS, PKCS #5, PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509
            : v3 certificates, and other security standards.

Available Packages
Name        : nss
Arch        : i686
Version     : 3.28.4
Release     : 4.el6_9
Size        : 882 k
Repo        : updates
Summary     : Network Security Services
URL         : http://www.mozilla.org/projects/security/pki/nss/
License     : MPLv2.0
Description : Network Security Services (NSS) is a set of libraries designed to
            : support cross-platform development of security-enabled client and
            : server applications. Applications built with NSS can support SSL v2
            : and v3, TLS, PKCS #5, PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509
            : v3 certificates, and other security standards.
```

```
yum update nss
```

## AFTER

TLSã§é€šä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¿ãŸã„ã ã€‚

>SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256

```
[root@e7495fa27993 /]# curl --verbose --head https://toolbelt.treasuredata.com/sh/install-ubuntu-xenial-td-agent2.sh
* About to connect() to toolbelt.treasuredata.com port 443 (#0)
*   Trying 151.101.89.177... connected
* Connected to toolbelt.treasuredata.com (151.101.89.177) port 443 (#0)
* Initializing NSS with certpath: sql:/etc/pki/nssdb
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
* Server certificate:
* 	subject: CN=l.ssl.fastly.net,O="Fastly, Inc.",L=San Francisco,ST=California,C=US
* 	start date: Apr 13 18:39:09 2018 GMT
* 	expire date: Jun 11 18:15:41 2020 GMT
* 	common name: l.ssl.fastly.net
* 	issuer: CN=GlobalSign Organization Validation CA - SHA256 - G2,O=GlobalSign nv-sa,C=BE
> HEAD /sh/install-ubuntu-xenial-td-agent2.sh HTTP/1.1
> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.15.3 zlib/1.2.3 libidn/1.18 libssh2/1.4.2
> Host: toolbelt.treasuredata.com
> Accept: */*
>
...
```

# ç’°å¢ƒ

- Centos6.6 ( docker )
- Docker version 18.03.1-ce, build 9ee9f40

# å‚è€ƒ

- [Wgetã‚„Curlã§GitHubã®SSLãŒæ€’ã‚‰ã‚ŒãŸæ™‚ - Qiita](https://qiita.com/Yangsin/items/86a35f1dc70545b34cc4)
- [SSL/TLSï¼ˆSSL3.0ï½TLS1.2ï¼‰ã®ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’å¾©ç¿’ã™ã‚‹ - Qiita](https://qiita.com/n-i-e/items/41673fd16d7bd1189a29)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->



# å…¬é–‹æ—¥æ™‚

2018-06-23
