---
title: Docker åˆå¿ƒè€… | ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ > docker-compose ã¨ docker stack ( å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« part
emoji: "ğŸ–¥"
type: "idea"
topics: ["åˆå¿ƒè€…", "Docker"]
published: true
---

[Get Started, Part 3: Services - Docker Documentation](https://docs.docker.com/get-started/part3/) ã‚ˆã‚Š

# ã“ã®ç« ã§æ‰±ã†ã“ã¨

- ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹
- ã‚¹ã‚¿ãƒƒã‚¯ > ã‚µãƒ¼ãƒ“ã‚¹(ä»Šã“ã“) > ã‚³ãƒ³ãƒ†ãƒŠ

# ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å„éƒ¨åˆ†ã¯ã€Œã‚µãƒ¼ãƒ“ã‚¹ã€ã¨å‘¼ã³æ–¹ã‚’ã™ã‚‹ã€‚
  - ãŸã¨ãˆã°å‹•ç”»å…±æœ‰ã‚µã‚¤ãƒˆãªã‚‰ã€DBã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‹ã€å‹•ç”»æœ¬ä½“ã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‹ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‹ã„ã†é¢¨ã«åˆ†ã‹ã‚Œã‚‹ã¯ãšã€‚
- ã‚µãƒ¼ãƒ“ã‚¹ã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã£ã¦ãªã‚‹ã€‚
- ã‚µãƒ¼ãƒ“ã‚¹ã¯1å€‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã€‚
- ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ãŸã‚ã«ã¯ã€1å€‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã©ã‚“ãªãƒãƒ¼ãƒˆã§ã€ä½•å€‹ã®ã‚³ãƒ³ãƒ†ãƒŠã§èµ°ã‚‰ã›ã‚‹ã‹ã€ã¨ã‹ã„ã†è¨­å®šãŒå¿…è¦ã ã€‚
- å–œã‚“ã§ã»ã—ã„ã€‚ docker-compose.yml ã‚’æ›¸ã‘ã°ã€ãã‚“ãªã“ã¨æœé£¯å‰ã•ã€‚

# docker-compose.yml

[å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« part2](http://qiita.com/YumaInaura/items/1bf6d76f97d73ae7c804) ã§ä½œã£ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¦ compose ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚

```docker-compose.yml
version: "3" # ã“ã® compose ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
services:
  web:
    image: yumainaura/get-started # è‡ªåˆ†ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¤ãƒ¡ãƒ¼ã‚¸ # python ã§ Web ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹
    deploy:
      replicas: 5 # èµ·å‹•ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®æ•°
      resources:
        limits:
          cpus: "0.1" # CPUã®ä¸Šé™å€¤
          memory: 50M # ãƒ¡ãƒ¢ãƒªã®ä¸Šé™
      restart_policy:
        condition: on-failure
    ports:
      - "80:80" # localã®80ç•ªãƒãƒ¼ãƒˆ:dockerã®80ç•ªãƒãƒ¼ãƒˆ ã‚’ã¤ãªã’ã‚‹
    networks: # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š (ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«æŒ‡å®šã—ãŸã‚‚ã®ã‹ã‚‰é¸ã¶)
      - webnet
networks: # ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
  webnet:
```

# swarm

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ãŠãã€‚æ„å‘³ã«ã¤ã„ã¦ã¯ä»Šå¾Œã®ç« ã§æ˜ã‚‰ã‹ã«ã•ã‚Œã‚‹ã‚‰ã—ã„ã€‚

```
$ docker swarm init
```

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

`getstartedlab` ã¨ã„ã†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ä¸ãˆã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚
( å®Ÿè¡Œã§ã¯ãªããƒ‡ãƒ—ãƒ­ã‚¤ã¨ã„ã†æ‰±ã„ )

```
$ docker stack deploy -c docker-compose.yml getstartedlab
```

# ã‚³ãƒ³ãƒ†ãƒŠã®ç¢ºèª

åŒã˜ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ä¸ãˆã¦ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªã™ã‚‹ã€‚

```
docker stack ps getstartedlab
```

`docker-compose.yml` ã§ `replicas: 5` ã«è¨­å®šã—ã¦ã‚ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠãŒ5å€‹èµ·å‹•ã—ã¦ã„ã‚‹ã€‚
ã“ã® replicas ã®è¨­å®šã‚’å¢—ã‚„ã™ã ã‘ã§ã€ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

```
ID            NAME                 IMAGE                          NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS
4hyp9xra2dmt  getstartedlab_web.1  yumainaura/get-started:latest  moby  Running        Running 45 seconds ago         
60ns7v9asl31  getstartedlab_web.2  yumainaura/get-started:latest  moby  Running        Running 46 seconds ago         
9o8clta8fpq9  getstartedlab_web.3  yumainaura/get-started:latest  moby  Running        Running 46 seconds ago         
w3tlfu97uffx  getstartedlab_web.4  yumainaura/get-started:latest  moby  Running        Running 46 seconds ago         
ybvi20wefg95  getstartedlab_web.5  yumainaura/get-started:latest  moby  Running        Running 46 seconds ago         
```

# ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹

http://localhost/ ã‚’è¦‹ã¦ã¿ã‚‹ã€‚

ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ãŸã³ã«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒˆåãŒå¤‰ã‚ã‚Šã€å…¨éƒ¨ã§äº”ç¨®é¡ã‚ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã¨æ€ã†ã€‚

![image](https://qiita-image-store.s3.amazonaws.com/0/89618/22723a1c-0758-7178-9e2f-4b09e8a52a86.png)

![image](https://qiita-image-store.s3.amazonaws.com/0/89618/07bceeb8-e263-65d5-f350-591b239a13db.png)

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’æŒ‡å®šã—ã¦ `rm` ã™ã‚‹ã€‚

```
$ docker stack rm getstartedlab
```

# å‚è€ƒ

- [Compose file version 3 reference - Docker Documentation](https://docs.docker.com/compose/compose-file/)








<!-- Update From Qiita API -->

# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ





# Twitter


https://twitter.com/YumaInaura


<!-- Update From Qiita API -->


